function checkFirst(){var a=$("#actname").val();if($.trim(a)==""){$("#errorMsg").html("\u6d3b\u52a8\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a");$("#errorMsg").css("display","");return false}if(a.length>40){$("#errorMsg").html("\u6d3b\u52a8\u540d\u79f0\u965040\u4e2a\u6c49\u5b57\u5b57\u7b26");$("#errorMsg").css("display","");return false}a=$("#startT").val();var b=$("#endT").val();if($.trim(a)==""){$("#errorMsg").html("\u4fc3\u9500\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a");$("#errorMsg").css("display",
"");return false}else if($.trim(b)==""){$("#errorMsg").html("\u4fc3\u9500\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a");$("#errorMsg").css("display","");return false}var c=new Date(Date.parse(a.replace(/-/g,"/"))),e=new Date(Date.parse(b.replace(/-/g,"/"))),d=new Date,f=d.getFullYear(),g=d.getMonth()+1;if(g>=1&&g<=9)g="0"+g;var j=d.getDate(),h=d.getHours();d=d.getMinutes();if(h>=1&&h<=9)h="0"+h;f=new Date(Date.parse((f+"-"+g+"-"+j+" "+h+":"+d).replace(/-/g,"/")));if(c-f<0){$("#errorMsg").html("\u4fc3\u9500\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u65e9\u4e8e\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4");
$("#errorMsg").css("display","");return false}if(c-e>0){$("#errorMsg").html("\u4fc3\u9500\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u65e9\u4e8e\u4fc3\u9500\u5f00\u59cb\u65f6\u95f4");$("#errorMsg").css("display","");return false}if(c-e==0){$("#errorMsg").html("\u4fc3\u9500\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u7b49\u4e8e\u4fc3\u9500\u5f00\u59cb\u65f6\u95f4");$("#errorMsg").css("display","");return false}c=(e-c)/3600/1E3;e=$("#timeLeft").val();e=parseInt(e);if(c>240){$("#errorMsg").html("\u5355\u4e2a\u6d3b\u52a8\u65f6\u95f4\u53ea\u80fd\u57281\u5230240\u4e2a\u5c0f\u65f6\u4e4b\u95f4");
$("#errorMsg").css("display","");return false}if(c>e){$("#errorMsg").html("\u6240\u5269\u6d3b\u52a8\u65f6\u95f4\u4e0d\u8db3"+c+"\u5c0f\u65f6,\u8bf7\u91cd\u8bbe");$("#errorMsg").css("display","");return false}$("#startTime").val(a);$("#endTime").val(b);$("#errorMsg").css("display","none");return true}function hideFirstTip(){$("#errorMsg").css("display","none")}$(function(){InitData()});
$("#first").click(function(){if(checkFirst()){setHt();$("#firstStep").hide();$("#firstUp").show();$("#secondStep").show();InitData()}});
function setHt(){$("#itemName").val("");$("#categoryId").val("");if($("#pages").val()==0){$("#Pagination").hide();$("#linkTable tr:gt(0)").remove();$("#linkTable").append('<tr><td colspan="4"><div style="text-align:center;color:red;"><span>\u60a8\u6ca1\u6709\u53ef\u4ee5\u53c2\u52a0\u6b64\u6b21\u6d3b\u52a8\u7684\u5546\u54c1</span></div></td></tr>')}else refeshPages(null,$("#linkTable tr:gt(0)"),$("#linkTable"))}
$("#firstUp").click(function(){$("#firstStep").css("display","");$("#firstUp").css("display","none");$("#secondStep").css("display","none");$("#secondUp").css("display","none");$("#thirdStep").css("display","none")});var index=0;
$("#hobby_all").click(function(){if($(this).prop("checked"))$('input[name="checkItem"]').each(function(){$(this).prop("checked")||$(this).prop("checked",true)});else{$('input[name="checkItem"]').each(function(){$(this).prop("checked")&&$(this).prop("disabled")==false&&$(this).prop("checked",false)});$("#countDiscount").html("\u7b2c\u4e09\u6b65 \u8bbe\u7f6e\u9650\u65f6\u6253\u6298("+index+")")}checkOne()});
function clickParticipate(a){index+=1;if(index>20){index-=1;alert("\u6bcf\u4e2a\u6d3b\u52a8\u6700\u591a\u6dfb\u52a020\u4e2a\u5546\u54c1,\u5df2\u8fbe\u4e0a\u9650\u65e0\u6cd5\u7ee7\u7eed\u6dfb\u52a0")}else{var b="b"+a.substring(a.indexOf("d")+1,a.length);b=$("#"+b).val();if(getThirdTr(b)){$("#"+a).css("display","none");a=a.substring(a.indexOf("d")+1,a.length);$("#n"+a).css("display","");$("#"+a).prop({checked:true,disabled:true})}else index-=1;$("#countDiscount").html("\u7b2c\u4e09\u6b65 \u8bbe\u7f6e\u9650\u65f6\u6253\u6298("+
index+")")}checkOne()}function clickNoParticipate(a){$("#"+a).css("display","none");var b=a.substring(a.indexOf("n")+1,a.length);$("#d"+b).css("display","");$("#d"+b).prop("disabled",false);$("#"+b).prop({checked:false,disabled:false});index-=1;$("#countDiscount").html("\u7b2c\u4e09\u6b65 \u8bbe\u7f6e\u9650\u65f6\u6253\u6298("+index+")");move(a);checkOne()}
$("#batch").click(function(){checkOne();var a=0;$('input[name="checkItem"]').each(function(){$(this).prop("checked")&&$(this).prop("disabled")==false&&a++});if(a==0)alert("\u81f3\u5c11\u9009\u4e2d\u4e00\u4ef6\u5546\u54c1");else{var b="";$('input[name="checkItem"]').each(function(){if($(this).prop("checked")&&$(this).prop("disabled")==false){index++;$(this).prop("disabled",true);$("#n"+this.id).css("display","");$("#d"+this.id).css("display","none");var e=$("#b"+this.id).val();if(getThirdTr(e))b+=
this.id+",";else{index--;$(this).prop("disabled",false);$("#n"+this.id).css("display","none");$("#d"+this.id).css("display","")}}});var c=b.lastIndexOf(",");c=b.substring(0,c).split(",");if(index>20){for(i=0;i<c.length;i++){$("#"+c[i]).prop("checked",false);$("#"+c[i]).prop("disabled",false);$("#n"+c[i]).css("display","none");$("#d"+c[i]).css("display","");index--;move("n"+c[i])}$("#hobby_all").prop("checked",false);if(20-index>0){alert("\u6bcf\u4e2a\u6d3b\u52a8\u6700\u591a\u6dfb\u52a020\u4ef6\u5546\u54c1,\u60a8\u6700\u591a\u8fd8\u53ef\u6dfb\u52a0"+
(20-index)+"\u4ef6\u5546\u54c1,\u8bf7\u60a8\u9009\u62e9\u8981\u53c2\u52a0\u7684\u5546\u54c1");return}if(20-index==0){alert("\u6bcf\u4e2a\u6d3b\u52a8\u6700\u591a\u6dfb\u52a020\u4e2a\u5546\u54c1,\u5df2\u8fbe\u4e0a\u9650\u65e0\u6cd5\u7ee7\u7eed\u6dfb\u52a0");return}}$("#countDiscount").html("\u7b2c\u4e09\u6b65 \u8bbe\u7f6e\u9650\u65f6\u6253\u6298("+index+")")}});
function getThirdTr(a){a=a.split(";");var b=$("#title_"+a[0]).val(),c=$("#iserver").val();b='<tr id="c'+a[0]+'"><input type ="hidden" name="itemId" value="'+a[0]+'"><td class="table-long"><img src="'+c+a[1]+'_40x40.jpg"/><a href="/detail/'+a[0]+'.htm" target="_brank" class="lan">'+replaceHTMLTag(b)+'</a></td><td class="center" id="p'+a[0]+'" name="prices">'+(parseInt(a[2])/100).toFixed(2)+'</td><td class="center"><input type="text" class="text" name="discontPrice" maxlength="4" onClick="clearSpan(this.id);" onkeyup="clearNoNum(this);" onBlur="discountPrice(this.id);" id="dis'+
a[0]+'" />\u6298<div class="absolute" style="display:none;" id="div'+a[0]+'"><span class="tip-red" style="display:none;" id="msg'+a[0]+'"></span></div></td><td class="center" id="dp'+a[0]+'" name="disPrice">0.00</td><td class="center"><input id="u'+a[0]+'" name="disnum" type="text" onChange="disCountCheck(this);" onkeyup="up(this);" onafterpaste="afterpaste(this);" maxlength="8" value="1" class="text"/></td><td class="center"><input type="button" id="a'+a[0]+'" onClick="del(this.id);" class="pl-btn-juse" value="\u5220\u9664"/></td></tr>';
if($("#c"+a[0]).val()==undefined){$("#tThird").append(b);return true}else return false}function move(a){a="c"+a.substring(a.indexOf("n")+1,a.length);$("#"+a).val()!=undefined&&$("#"+a).remove()}
$("#complete").click(function(){if(index==0){$("#secondMs").html("\u81f3\u5c11\u6dfb\u52a0\u4e00\u4ef6\u5546\u54c1");$("#secondMs").css("display","")}else{$("#thirdStep").css("display","");$("#secondStep").css("display","none");$("#secondUp").css("display","");$("#secondMs").html("");$("#secondMs").css("display","none");$("#hobby_all").prop("checked",false);$('input[name="checkItem"]').each(function(){if($(this).prop("checked")){$(this).prop("disabled",false);$(this).prop("checked",false);$("#n"+
this.id).css("display","none");$("#d"+this.id).css("display","");$("#d"+this.id).prop("disabled",false)}})}});$("#secondUp").click(function(){$("#secondStep").css("display","");$("#secondUp").css("display","none");$("#firstStep").css("display","none");$("#firstUp").css("display","");$("#thirdStep").css("display","none");setSyle()});
function del(a){if(del_true()){a="c"+a.substring(a.indexOf("a")+1,a.length);$("#"+a).remove();index--;$("#countDiscount").html("\u7b2c\u4e09\u6b65  \u8bbe\u7f6e\u9650\u65f6\u6253\u6298("+index+")")}}function del_true(){return confirm("\u786e\u5b9a\u8981\u4ece\u672c\u9650\u65f6\u6253\u6298\u6d3b\u52a8\u4e2d\u5220\u9664\u672c\u5546\u54c1\u5417?")==true?true:false}
function discountPrice(a){var b=$("#"+a).val(),c=b.indexOf(".");if($.trim(b)!=""){b=c==-1?parseInt(b,10):parseFloat(b);$("#"+a).val(b)}b=$("#"+a).val();a=a.substring(a.indexOf("dis")+3,a.length);if($.trim(b)==""){$("#dp"+a).html("0.00");$("#msg"+a).html("");$("#msg"+a).css("display","none");$("#div"+a).css("display","none");return false}if(b==0){$("#msg"+a).html("\u6298\u6263\u503c\u4e0d\u80fd\u7b49\u4e8e0");$("#msg"+a).css("display","");$("#div"+a).css("display","");return false}if(b>9.5){$("#msg"+
a).html("\u6298\u6263\u503c\u4e0d\u80fd\u5927\u4e8e9.5");$("#msg"+a).css("display","");$("#div"+a).css("display","");return false}c=$("#p"+a).html();b=(Math.round(c*b*100)/1E3).toFixed(2);if(b<1){$("#msg"+a).html("\u6298\u540e\u4ef7\u4e0d\u80fd\u5c0f\u4e8e1\u5143");$("#msg"+a).css("display","");$("#div"+a).css("display","");return false}else $("#dp"+a).html(b);$("#msg"+a).html("");$("#msg"+a).css("display","none");$("#div"+a).css("display","none")}
function clearNoNum(a){a.value=a.value.replace(/^0{2,}/g,"");a.value=a.value.replace(/[^\d.]/g,"");a.value=a.value.replace(/^\.{1,}/g,"");a.value=a.value.replace(/\.{2,}/g,".");a.value=a.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".")}
function checkDisA(){$("#discount");var a=$("#discount").val(),b=$("#disnumber").val();if($.trim(a)!=""){a=a.indexOf(".")==-1?parseInt(a,10):parseFloat(a);$("#discount").val(a)}a=$("#discount").val();if($.trim(a)==""&&$.trim(b)==""){$("#thirdMsg").removeClass("tip");$("#thirdMsg").addClass("tip-red");$("#thirdMsg").html("\u8bf7\u5148\u8f93\u5165\u6298\u6263\u6216\u8005\u9650\u8d2d\u6570\u518d\u4f7f\u7528\u6279\u91cf\u8bbe\u7f6e\uff0c\u4e14\u6570\u503c\u4e0d\u80fd\u4e3a0");$("#thirdMsg").css("display",
"");return false}if($.trim(a)!=""&&parseFloat($.trim(a)).toFixed(1)==0){$("#thirdMsg").removeClass("tip");$("#thirdMsg").addClass("tip-red");$("#thirdMsg").html("\u8bf7\u5148\u8f93\u5165\u6298\u6263\u6216\u8005\u9650\u8d2d\u6570\u518d\u4f7f\u7528\u6279\u91cf\u8bbe\u7f6e\uff0c\u4e14\u6570\u503c\u4e0d\u80fd\u4e3a0");$("#thirdMsg").css("display","");return false}if($.trim(b)!=""&&parseFloat($.trim(b)).toFixed(1)==0){$("#thirdMsg").removeClass("tip");$("#thirdMsg").addClass("tip-red");$("#thirdMsg").html("\u8bf7\u5148\u8f93\u5165\u6298\u6263\u6216\u8005\u9650\u8d2d\u6570\u518d\u4f7f\u7528\u6279\u91cf\u8bbe\u7f6e\uff0c\u4e14\u6570\u503c\u4e0d\u80fd\u4e3a0");
$("#thirdMsg").css("display","");return false}if(a>9.5){$("#thirdMsg").removeClass("tip");$("#thirdMsg").addClass("tip-red");$("#thirdMsg").html("\u6298\u6263\u503c\u4e0d\u80fd\u5927\u4e8e9.5");$("#thirdMsg").css("display","");return false}return true}$("#discount").focus(function(){$("#discount").select();$("#thirdMsg").removeClass("tip-red");$("#thirdMsg").addClass("tip");$("#thirdMsg").html("\u53ef\u8bbe\u7f6e\u7684\u6700\u9ad8\u6298\u6263\u4e3a9.5\u6298\uff0c\u4e14\u6298\u540e\u4ef7\u4e0d\u80fd\u5c0f\u4e8e1.00\u5143")});
$("#disnumber").focus(function(){$("#disnumber").select();$("#thirdMsg").removeClass("tip-red");$("#thirdMsg").addClass("tip");$("#thirdMsg").html("\u53ef\u8bbe\u7f6e\u7684\u6700\u9ad8\u6298\u6263\u4e3a9.5\u6298\uff0c\u4e14\u6298\u540e\u4ef7\u4e0d\u80fd\u5c0f\u4e8e1.00\u5143")});
$("#setDisAll").click(function(){var a=0;if(checkDisA()){var b=$("#discount").val();if($.trim(b)!=""){b=b.indexOf(".")==-1?parseInt(b,10):parseFloat(b);$("#discount").val(b)}for(var c=$("#disnumber").val(),e=document.getElementsByName("discontPrice"),d=0;d<e.length;d++){var f=e[d].id.substring(e[d].id.indexOf("dis")+3,e[d].id.length);if($.trim(b)!=""){$("#"+e[d].id).val(b);var g=$("#p"+f).html();g=(Math.round(g*b*100)/1E3).toFixed(2);if(g<1){$("#msg"+f).html("\u6298\u540e\u4ef7\u4e0d\u80fd\u5c0f\u4e8e1\u5143");
$("#msg"+f).css("display","");$("#div"+f).css("display","");a++}else $("#dp"+f).html(g)}else{$("#dp"+f).html("0.00");$("#"+e[d].id).val("")}$.trim(c)!=""&&$("#u"+f).val(c);if(a==0){$("#msg"+f).html("");$("#msg"+f).css("display","none");$("#div"+f).css("display","none")}}}checkOne()});
function checkAllVal(){var a=document.getElementsByName("discontPrice"),b=0;for(i=0;i<a.length;i++){var c=a[i].id;c=c.substring(c.indexOf("dis")+3,c.length);var e=$("#"+a[i].id).val();if($.trim(e)==""){$("#msg"+c).html("\u6298\u6263\u503c\u4e0d\u80fd\u4e3a\u7a7a");$("#msg"+c).css("display","");$("#div"+c).css("display","");b++}if($.trim(e)!=""){var d=$("#p"+c).html();d=(Math.round(d*e*100)/1E3).toFixed(2);if(e==0){$("#msg"+c).html("\u6298\u6263\u503c\u4e0d\u80fd\u7b49\u4e8e0");$("#msg"+c).css("display",
"");$("#div"+c).css("display","");b++}if(d<1&&e!=0){$("#msg"+c).html("\u6298\u540e\u4ef7\u4e0d\u80fd\u5c0f\u4e8e1\u5143");$("#msg"+c).css("display","");$("#div"+c).css("display","");b++}if(e>9.5){$("#msg"+c).html("\u6298\u6263\u503c\u4e0d\u80fd\u5927\u4e8e9.5");$("#msg"+c).css("display","");$("#div"+c).css("display","");b++}}}if(b!=0)return false;return true}
$("#lastStep").click(function(){if(checkAllVal())if(checkFirst()){$("#lastStep").attr("disabled",true);$("#form1").submit()}else{$("#firstStep").css("display","");$("#firstUp").css("display","none");$("#secondStep").css("display","none");$("#secondUp").css("display","none");$("#thirdStep").css("display","none")}});function clearSpan(a){a=a.substring(a.indexOf("dis")+3,a.length);$("#msg"+a).html("");$("#msg"+a).css("display","none");$("#div"+a).css("display","none")}
function disCountCheck(a){var b=$(a).val();$.trim(b)!=""&&parseInt(b)==0&&$(a).val("")}function setSyle(){var a=document.getElementsByName("discontPrice");if(a.leng!=0||a!=undefined)$('input[name="checkItem"]').each(function(){for(i=0;i<a.length;i++){var b=a[i].id.substring(a[i].id.indexOf("dis")+3,a[i].id.length);if(b==this.id){$("#"+b).prop({checked:true,disabled:true});$("#n"+b).css("display","");$("#d"+b).css("display","none")}}})}
function give_up(){if(confirm("\u786e\u8ba4\u540e\u672c\u6b21\u7684\u4fc3\u9500\u8bbe\u7f6e\u5c06\u4e22\u5931\uff0c\u786e\u5b9a\u653e\u5f03\u5417?"))document.location.href="/active/promotionManager.htm"}$("#categoryId").change(function(){var a=$("#categoryId").val();a={categoryId:$.trim(a)};refeshPages(a,$("#linkTable tr:gt(0)"),$("#linkTable"))});$("#categoryId").click(function(){$("#query-tip").hide()});
$("#searche").click(function(){var a=$("#itemName").val(),b=$("#categoryId").val();a={categoryId:$.trim(b),itemName:$.trim(a)};refeshPages(a,$("#linkTable tr:gt(0)"),$("#linkTable"));$(this).blur()});$("#searche").dblclick(function(){return false});$("#itemName").focus(function(){$("#query-tip").hide()});$("#searche").blur(function(){$("#query-tip").hide()});
function ajaxCallBack(a){var b=$("#iserver").val(),c="";a=eval(a);if(a.length>0){$("#hobby_all").prop("checked",false);$.each(a,function(e,d){$("#linkTable tr:gt(0)").remove();var f="";f+=d.featuresMap.limitDiscount==undefined?"<tr><input type='hidden' id='b"+d.id+"' value='"+d.id+";"+d.picUrl+";"+d.price+";"+d.curStock+"' /><input type='hidden' id='title_"+d.id+"' value='"+replaceHTMLTag(d.title)+"' /><td class=\"w5 center\"><input type='checkbox' id='"+d.id+"' onClick='checkOne();' name='checkItem' value='"+
d.id+"'></td><td><img src='"+b+d.picUrl+"_40x40.jpg' /><a href='/detail/"+d.id+".htm ' target='_blank' class='lan'>"+replaceHTMLTag(d.title)+'</a></td><td class="w15 center">'+(parseInt(d.price)/100).toFixed(2)+"</td><td class=\"w15 center\"><input type='button' value='\u53c2\u52a0\u6253\u6298' id='d"+d.id+"' class='pl-btn-juse' onClick='clickParticipate(this.id);'/><input type='button' value='\u4e0d\u53c2\u52a0\u4e86' class='pl-btn-hui' id='n"+d.id+"' style='display:none;' onClick='clickNoParticipate(this.id);'/></td></tr>":
"<tr><td class=\"w5 center\"><input type='checkbox' disabled='disabled' checked='checked'></td><td><img src='"+b+d.picUrl+"_40x40.jpg' /><a href='/detail/"+d.id+".htm ' target='_blank' class='lan'>"+replaceHTMLTag(d.title)+'</a></td><td class="w15 center">'+(parseInt(d.price)/100).toFixed(2)+"</td><td class=\"w15 center\"><input type='button' class='pl-btn-hui' value='\u5df2\u53c2\u52a0\u6d3b\u52a8' disabled='disabled'></td></tr>";c+=f});$("#linkTable").append(c);setSyle()}}
function up(a){if(a.value.length==1)a.value=a.value.replace(/[^1-9]/g,"");else if(a.value.length>1){a.value=a.value.replace(/^0{1,}/g,"");a.value=a.value.replace(/\D/g,"")}}function afterpaste(a){if(a.value.length==1)a.value=vvalue.replace(/[^1-9]/g,"");else{a.value=a.value.replace(/^0{1,}/g,"");a.value=a.value.replace(/\D/g,"")}}function ups(a){a.value=a.value.replace(/^0{1,}/g,"")}function afterpastes(a){a.value=a.value.replace(/^0{1,}/g,"")}
function checkOne(){$("#secondMs").css("display","none")}function replaceHTMLTag(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/\'/g,"&#039;");return a=a.replace(/\"/g,"&quot;")};
