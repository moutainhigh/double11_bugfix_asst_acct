if(!window.console){window.console={}}if(!console.log){console.log=function(){}}if(!console.info){console.info=function(){}}var PinjuCookie=function(c,b,a){this.base=c;this.logoutLink=b?"?returnUrl="+encodeURIComponent(b):"";this.debug=!!a;this.cookieMap=this._getCookies()};PinjuCookie.DEBUG=true;PinjuCookie.TOKEN="TOKEN";PinjuCookie.LOGS=["N"];PinjuCookie.SDO_CHECKER="SDO";PinjuCookie.SD="SD";PinjuCookie.SC="SC";PinjuCookie.SDO_CHECKER_INTERVAL=5*60*1000;PinjuCookie.P="P";PinjuCookie.UNLOGIN='<span><a href="{0}/member/login.htm{1}">\u8bf7\u767b\u5f55</a></span> <span><a href="{0}/member/register.htm{1}">\u514d\u8d39\u6ce8\u518c</a></span>';PinjuCookie.LOGIN_NO_NICKNAME='<span>\u60a8\u597d\uff0c\u6b22\u8fce\u6765\u5230\u54c1\u805a\uff0c\u8bf7\u70b9\u51fb<a href="{0}/my/info.htm" title="\u586b\u5199\u59d3\u540d\u3001\u6635\u79f0\uff0c\u4ee5\u53ca\u8054\u7cfb\u65b9\u5f0f\u7b49">\u8fd9\u91cc</a>\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f</span> <span><a href="{0}/member/logout.htm">\u9000\u51fa</a></span>';PinjuCookie.LOGIN='<span>\u60a8\u597d\uff0c<a href="{0}/my/info.htm">{1}</a> \u6b22\u8fce\u6765\u5230\u54c1\u805a</span> <span><a href="{0}/member/logout.htm{2}">\u9000\u51fa</a></span>';PinjuCookie.SDO='<iframe src="{0}/sdo.html" width="0" height="0"></iframe>';PinjuCookie.COOKIE_TEMPLATE="{0}={1}; domain={2}; path={3}; expires={4}";PinjuCookie.writeCookie=function(c,e,d,f,a){var b=new Date();b.setTime(b.getTime()+a*60000);document.cookie=pinju.Person.format(PinjuCookie.COOKIE_TEMPLATE,c,encodeURIComponent(e),(d||PJ.COOKIE_DOMAIN),(f||"/"),b.toGMTString())};PinjuCookie.writeSdoCookie=function(a){PinjuCookie.writeCookie(PinjuCookie.SDO_CHECKER,new Date().getTime(),PJ.COOKIE_DOMAIN,"/",a)};PinjuCookie.clearCookie=function(a,b,c){PinjuCookie.writeCookie(a,"",b,c,0)};PinjuCookie.ignoreLinks=[encodeURIComponent("/security/forgot-password.htm"),encodeURIComponent("/security/forgot-password-do.htm"),encodeURIComponent("/security/link.htm"),encodeURIComponent("/security/retrieve-password-do.htm")];PinjuCookie.prototype={isLogin:function(){if(!this._isTokenCorrect()){return false}return(this._findLogin().length==PinjuCookie.LOGS.length)},isSdoTimeout:function(){var a=this.getValue(PinjuCookie.SDO_CHECKER);if(!a){PinjuCookie.DEBUG&&window.console&&console.info("cannot find sdo checker cookie, need check sdo");return true}var b=new Date().getTime();PinjuCookie.DEBUG&&window.console&&console.info("current time: %d, sdo cookie time: %d, diff: %f",a,b,(b-a)/60000);return b-a>PinjuCookie.SDO_CHECKER_INTERVAL},writeSdoChecker:function(){this._write(pinju.Person.format(PinjuCookie.SDO,this.base))},getShoppingCartCount:function(){var a=this.getValue(PinjuCookie.SD);PinjuCookie.DEBUG&&window.console&&console.info("cart count: %s",a);if(isNaN(a)){return 0}return a},getShoppingCartContent:function(){return this.getValue(PinjuCookie.SC)},getAdvertiseInfo:function(){var a=decodeURIComponent(this.getValue(PinjuCookie.P));if(a){var c=a.split("-");if(parseInt(c[1])==0){return a.substr(0,a.lastIndexOf("-"))}else{var f=parseInt(c[2]);var b=new Date().getTime();var e=(b-f)/(24*60*60*1000);if(e>15){var d=c[0]+"-0-"+c[2];PinjuCookie.writeCookie(PinjuCookie.P,d,PJ.COOKIE_DOMAIN,"/",31536000);return c[0]+"-0"}else{return a.substr(0,a.lastIndexOf("-"))}}}else{return""}},getAdvertise:function(){var c,e;var f=window.location.href;var b=f.indexOf("?");f=f.substr(b+1);var a=f.split("&");for(var d=0;d<a.length;d++){b=a[d].indexOf("=");if(b>0){c=a[d].substring(0,b);if(c=="p"){e=a[d].substr(b+1)}}}if(e==undefined||e==""){e=this.getAdvertiseInfo()}if(e){return e}else{return""}},getValue:function(a){return this.cookieMap[a]},showLoginNav:function(){var b=this._findLogin();if(!this._isTokenCorrect()){this._write(pinju.Person.format(PinjuCookie.UNLOGIN,this.base,this._generateReturnUrl()));this._clearLogin(b);return false}if(b.length!=PinjuCookie.LOGS.length){this._clearLogin(b);this._write(pinju.Person.format(PinjuCookie.UNLOGIN,this.base,this._generateReturnUrl()));return false}var a=decodeURI(this.getValue("N"));if(a=="[UNKNOWN]"){this._write(pinju.Person.format(PinjuCookie.LOGIN_NO_NICKNAME,this.base));return true}this._write(pinju.Person.format(PinjuCookie.LOGIN,this.base,a,this.logoutLink))},_generateReturnUrl:function(){var c=encodeURIComponent(this._getReturnUrl());PinjuCookie.DEBUG&&window.console&&console.info("[_generateReturnUrl] returnUrl [%s]",c);if(!c||c.length==0){return""}for(var b=0,a=PinjuCookie.ignoreLinks.length;b<a;b++){if(c.indexOf(PinjuCookie.ignoreLinks[b])>0){PinjuCookie.DEBUG&&window.console&&console.info("[_generateReturnUrl] returnUrl [%s] contains ignore symbol [%s]",c,PinjuCookie.ignoreLinks[b]);return""}}if(this._isRegister(c)){return this._getLinkReturnUrl(c)}return"?returnUrl="+c},_isRegister:function(a){if(a.indexOf("register.htm")>0){return true}if(a.indexOf("register-do.htm")>0){return true}return false},_isTokenCorrect:function(){return true},_clearLogin:function(d){var c=0;for(var b=0,a=d.length;b<a;b++){PinjuCookie.clearCookie(d[b]);c++}return c},_findLogin:function(){var c=[];for(var b=0,a=PinjuCookie.LOGS.length;b<a;b++){if(this.cookieMap[PinjuCookie.LOGS[b]]){c.push(PinjuCookie.LOGS[b])}}return c},_getCookies:function(){var d=document.cookie.split(/;\s+/);var b=[];for(var c=0,a=d.length;c<a;c++){var e=d[c].split("=");b[e[0]]=this._removeVersion1Quote(e[1])}return b},_getReturnUrl:function(){return location.href.replace(/([?&])(?:[?&]?r=[0-9]+)+(.)?/g,function(e,d,f){if(!f){return""}if(d=="?"){return"?"}return"&"})},_getLinkReturnUrl:function(b){if(!b){return""}b=decodeURIComponent(b);RegExp.lastIndex=0;var a=b.match(/[?&]returnUrl=([^&]+)/);if(!a||a.length<2){return""}return"?returnUrl="+a[1]},_write:function(a){document.write(a)},_removeVersion1Quote:function(a){if(!a||a.indexOf('"')<0){return a}return a.replace(/^"/,"").replace(/"$/,"")}};
