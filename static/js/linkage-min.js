(function(d){var s="000000";var a="-- \u8bf7\u9009\u62e9 --";var c="-1";var h;var t;var p={debug:false,links:undefined,isLinkValue:false,lastLink:undefined,defaultValue:undefined};var r;d.fn.linkage=function(w,v){h=d(this);t=w;d.extend(p,arguments[1]||{});r=new o().init(h);return r};var f=function(){for(var w=0,v=1;v<h.length;w++,v++){g(w,v);h[w].value=c}p.debug&&window.console&&console.info("init linkages bind finished");if(p.links){h.each(function(x){d(this).bind("change",function(){i(x,this,d(this).val())})})}l()};var l=function(){for(var w=0,v=h.length;w<v;w++){d(h[w]).context.options[0]=b(c,a)}};var j=function(w){if(!p.defaultValue){return}w.unshift(s);for(var x=0,v=h.length;x<v;x++){e(h[x],w[x],w[x+1],w[x+1])}};var m=function(y,A){if(!A){A=2}var z=-1,x=t.length;var w=0;while(z+1!=x){var v=(z+x)>>1;if(t[v][A]<y){z=v}else{x=v}}return(x<t.length&&t[x][A]==y)?x:-1};var k=function(y,w,B){var C=m(y);if(C<0){return[]}var A=t[C][2],x=[];var v=t.length-1;while(A==y){var z=t[C][0];x.push(b(z,t[C][1],z==w,z==B));if(C==v){break}A=t[++C][2]}return x};var b=function(y,v,x,w){return new Option(v,y,!!x,!!w)};var e=function(w,y,x,z){var v=k(y,x,z);n(w,v)};var n=function(x,w){if(!w||w.length==0){return}var z=d(x).context;for(var y=0,v=w.length;y<v;y++){z.options.add(w[y])}};var g=function(w,v){if(v>=h.length){return}var y=h[w];var x=h[v];d(y).bind("change",function(){p.debug&&window.console&&console.info("bind change value: %s",this.value);q(x,this.value)})};var q=function(v,w){v.options.length=1;var x=m(w);if(x<0){d(v).trigger("change");return}e(v,w);d(v).trigger("change")};var i=function(v,x,y){if(!p.links){return}d(p.links[v]).val(p.isLinkValue?y:r.getName(y));p.debug&&window.console&&console.info("fire change event, change value to %i, value %s",v,p.isLinkValue?y:r.getName(y));for(var w=h.length-1;w>-1;w--){var z=d(h[w]).val();p.debug&&window.console&&console.info("fire change event, find last link, index %i : value %s",w,z);if(z>-1){d(p.lastLink).val(z);p.debug&&window.console&&console.info("fire change event, last link set value: %s, lastLink name: %s",z,d(p.lastLink).attr("name"));break}}};var u=function(y){RegExp.lastIndex=0;var v=y.match(/\d{2}/g);if(!v){return -1}p.debug&&window.console&&console.info("get parent code, code: %s, arr: %s",y,v);for(var x=1,w=v.length;x<w;x++){if(v[x]=="00"){v[x-1]="00";return v.join("")}}v[v.length-1]="00";return v.join("")};var o=function(){return{container:null,init:function(v){this.container=v;f();if(!p.defaultValue){e(h[0],s)}else{j(this.getLinks())}return this},getLinks:function(w){if(!w&&!p.defaultValue){return[]}var y=[],x=w||p.defaultValue,z=100;while(x>0){if(x%z!=0){y.unshift(x)}x=Math.floor(x/z)*z;z*=100}return y},setValue:function(){if(!arguments&&arguments.length<1){return}var w=this.getLinks(arguments[0]);for(var x=0,v=w.length;x<v;x++){d(h[x]).val(w[x]).trigger("change")}},getName:function(y){var z=u(y);var w=m(z);if(w<0){return""}for(var x=w,v=t.length;x<v;x++){if(t[x][0]==y){p.debug&&window.console&&console.info("find code: %s value: %s, index: %d, search: %d",y,t[x][1],x,x-w);return t[x][1]}}}}}})(jQuery);
