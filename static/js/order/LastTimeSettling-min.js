jQuery(document).ready(function(b){b(".text-amount").each(function(){b(this).numeral({decimalPlace:0,maxLength:6})});link=b("#province, #city, #district").linkage(pcd,{links:b("#mprovince, #mcity, #mdistrict"),lastLink:"#mpcdCode"});b("#tipBuyNum").hide();loadSelect();queryAreaLogistics();loadAreaLogistics();selectFavo();sumPrice();showUpdate();b("input[id=guoMaiNum]").blur(function(){if(b(this).val()==""){alert("\u8bf7\u6b63\u786e\u8f93\u5165\u8d2d\u4e70\u6570\u91cf,\u4e14\u8d2d\u4e70\u6570\u4e0d\u80fd\u5c0f\u4e8e 1 \u4ef6");b("input[id=guoMaiNum]").val(1)}loadSelect();sumPrice()});isAddress();radioClickColor();b("#validateCode").keyup(function(){var c=b(this);c.val(c.val().toUpperCase())});var a=function(){var c=b("#captcha-img");if(b.browser.msie&&b.browser.version==6){setTimeout(function(){c.attr("src",c.attr("basesrc")+"&r="+Math.random())},0)}else{c.attr("src",c.attr("basesrc")+"&r="+Math.random())}b("#validateCode").val("").focus()};b("#captcha-img").click(a);b("#captcha-change").click(a);getRadio()});function loadAddress(){$.getJSON("/orderBuyer/loadAddressAjax.htm?x=Math.Random()",function(b){if(b.deliveries.length<=0){isAddress();return}$("#myTab").html("");for(i in b.deliveries){var a="";a+="<li style='width:97%'>";a+="<input name='memberDeliveryId' checkName="+b.deliveries[i].id+" areaName="+b.deliveries[i].province+" areaValue="+b.deliveries[i].pcdCode+" type='radio' value="+b.deliveries[i].id+" style='cursor:pointer;' onclick='radioClickColor()' title='\u9009\u62e9\u5730\u5740'/>&nbsp;";a+=encode(b.deliveries[i].receiverName)+"&nbsp;&nbsp;&nbsp;&nbsp;";a+=b.deliveries[i].province+"&nbsp;&nbsp;";a+=b.deliveries[i].city+"&nbsp;";a+=b.deliveries[i].district;a+=encode(b.deliveries[i].address)+"\uff0c";a+=b.deliveries[i].zipCode+"&nbsp;";if(b.deliveries[i].phone!=null&&b.deliveries[i].mobile!=null){a+="\uff0c"+b.deliveries[i].phone+"\uff0c"+b.deliveries[i].mobile}else{if(b.deliveries[i].phone!=null&&b.deliveries[i].mobile==null){a+="\uff0c"+b.deliveries[i].phone}else{if(b.deliveries[i].phone==null&&b.deliveries[i].mobile!=null){a+="\uff0c"+b.deliveries[i].mobile}}}if(b.deliveries[i].status==1){a+='<span style="color:red">\uff08\u9ed8\u8ba4\uff09</span>'}a+='&nbsp;&nbsp;&nbsp;&nbsp;<span style="display:none;" id="addressSpan'+b.deliveries[i].id+'"><a href="#" class="lan" onmousedown="editAddress('+b.deliveries[i].id+","+b.deliveries[i].pcdCode+');" title="\u70b9\u51fb\u540e\u7f16\u8f91\u6846\u4e2d\u8fdb\u884c\u4fee\u6539">\u4fee\u6539</a>';if(b.deliveries[i].status==0){a+='<span style="margin-left:10px"><a href="#" class="lan" onmousedown="defAddress('+b.deliveries[i].id+","+b.deliveries[i].pcdCode+');" title="\u5c06\u6b64\u6761\u5730\u5740\u8bbe\u4e3a\u9ed8\u8ba4\u6536\u8d27\u5730\u5740">&nbsp;&nbsp;\u8bbe\u4e3a\u9ed8\u8ba4</a></span>'}a+="</span>";a+='<input type="hidden" value="'+b.deliveries[i].zipCode+'" hidedenMemberDelivery="'+b.deliveries[i].id+'zipCode"/>';a+='<input type="hidden" value="'+encode(b.deliveries[i].address)+'" hidedenMemberDelivery="'+b.deliveries[i].id+'address"/>';a+='<input type="hidden" value="'+encode(b.deliveries[i].receiverName)+'" hidedenMemberDelivery="'+b.deliveries[i].id+'receiverName"/>';a+='<input type="hidden" value="'+b.deliveries[i].status+'" hidedenMemberDelivery="'+b.deliveries[i].id+'status"/>';a+='<input type="hidden" value="'+b.deliveries[i].phone+'" hidedenMemberDelivery="'+b.deliveries[i].id+'phone"/>';a+='<input type="hidden" value="'+b.deliveries[i].mobile+'" hidedenMemberDelivery="'+b.deliveries[i].id+'mobile"/>';a+='<input type="hidden" value="'+b.deliveries[i].province+'" hidedenMemberDelivery="'+b.deliveries[i].id+'province"/>';a+='<input type="hidden" value="'+b.deliveries[i].city+'" hidedenMemberDelivery="'+b.deliveries[i].id+'city"/>';a+='<input type="hidden" value="'+b.deliveries[i].district+'" hidedenMemberDelivery="'+b.deliveries[i].id+'district"/>';a+="</li>";$("#myTab").append(a)}isAddress();setSellect(updateId);radioVal=updateId;queryAreaLogistics();loadAreaLogistics();radioClickColor()})}var ENCODE=[{reg:/&/g,rep:"&amp;"},{reg:/</g,rep:"&lt;"},{reg:/>/g,rep:"&gt;"},{reg:/"/g,rep:"&quot;"},{reg:/ /g,rep:"&nbsp;"}];function encode(b){for(var a=0;a<ENCODE.length;a++){b=b.replace(ENCODE[a]["reg"],ENCODE[a]["rep"])}return b}var idNotAdd;var updateId;function editAddress(a,b){updateId=a;idNotAdd=1;setEditValue(a,b);link.setValue(b);$("#editAddressTable").show()}function defAddress(a,b){setEditValue(a,b);link.setValue(b);$("#statusCheckbox").attr("checked","true");submitEditDelivery(2)}function setEditValue(f,l){var h="input[hidedenMemberDelivery*="+f+"zipCode]";var c="input[hidedenMemberDelivery*="+f+"address]";var m="input[hidedenMemberDelivery*="+f+"receiverName]";var a="input[hidedenMemberDelivery*="+f+"phone]";var g="input[hidedenMemberDelivery*="+f+"mobile]";var o="input[hidedenMemberDelivery*="+f+"province]";var e="input[hidedenMemberDelivery*="+f+"city]";var d="input[hidedenMemberDelivery*="+f+"district]";var p="input[hidedenMemberDelivery*="+f+"status]";$("textarea[memberDelivery*=address]").val($(c).val());$("input[memberDelivery*=zipCode]").val($(h).val());$("input[memberDelivery*=receiverName]").val($(m).val());$("input[memberDelivery*=phone]").val($(a).val());$("input[memberDelivery*=mobile]").val($(g).val());$("input[memberDelivery*=deliveryId]").val(f);$("input[memberDelivery*=pcdCode]").val(l);$("input[memberDelivery=province]").val($(o).val());$("input[memberDelivery=city]").val($(e).val());$("input[memberDelivery=district]").val($(d).val());if($(p).val()=="1"){$("#statusCheckbox").attr("checked","true")}else{$("#statusCheckbox").removeAttr("checked")}var k=$(a).val();$("#area").val("");$("#tel").val("");$("#ext").val("");var b=/(?:\((\d+)\))?(\d+)?(?:\*(\d+))?/g.exec(k);if(!b){return}$("#area").val(b[1]);$("#tel").val(b[2]);$("#ext").val(b[3])}function submitEditDelivery(p){if(idNotAdd==0){if($("input[name=memberDeliveryId]").size()==11){$("#countspan").show();return}}var l=$("input[memberDelivery=receiverName]").val();l=l.replace(/\s+/g,"");var q=$("textarea[memberDelivery=address]").val();q=q.replace(/\s+/g,"");var a=$("input[memberDelivery=zipCode]").val();var n=$("#tel").val();var c=$("#area").val();var b=$("input[memberDelivery=mobile]").val();var d=$("#ext").val();var e=$("select[id=province]").val();var k=$("select[id=city]").val();var r=$("select[id=district]").val();if(l==""){alert("\u6536\u8d27\u4eba\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(l.length<2||l.length>20){alert("\u6536\u8d27\u4eba\u59d3\u540d\u5e94\u5728 2 \u5230 20 \u4e2a\u5b57\u7b26\u4e4b\u95f4\uff01");return}if((e==null||e=="-1")&&(k==null||k=="-1")){alert("\u7701\u4efd\u3001\u57ce\u5e02\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(e==null||e=="-1"){alert("\u7701\u4efd\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(k==null||k=="-1"){alert("\u57ce\u5e02\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(q==""){alert("\u8857\u9053\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(q.length>=200){alert("\u8857\u9053\u5730\u5740\u5e94\u5728 200 \u4e2a\u5b57\u7b26\u4ee5\u5185\uff01");return}if(a==""){alert("\u90ae\u653f\u7f16\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}var h=/^(?:(?:0[1-7]|[1-8][0-9])[0-9]{4})?$/;if(!h.test(a)){alert("\u90ae\u653f\u7f16\u7801\u683c\u5f0f\u4e0d\u6b63\u786e\uff01");return}if(b==""&&n==""){alert("\u8bf7\u8f93\u7535\u8bdd\u53f7\u7801\u6216\u624b\u673a\u53f7\u7801\uff01");return}var m=/^(?:0[1-9][0-9][0-9]?)?$/;if(c!=""){if(!m.test(c)){alert("\u533a\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e\uff01");return}}var s=/^(?:[1-9][0-9]{5,7})?$/;var o=/^(?:1[3458][0-9]{9})$/;if(n!=""){if(!s.test(n)){alert("\u7535\u8bdd\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e");return}}var g=/^(?:[0-9]{1,8})?$/;if(g!=""){if(!g.test(d)){alert("\u5206\u673a\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e\uff01");return}}if(b!=""){if(!o.test(b)){alert("\u624b\u673a\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e");return}}var f=$("#editAddFrom").serializeArray();$.post("/orderBuyer/orderDelivery.htm?k=Math.Random()",f,function(t){alert(t.resultMessage);updateId=t.memberDelivery.id;loadAddress();$("#editAddressTable").hide();clearForm()})}function clearForm(){$("textarea[memberDelivery*=address]").val("");$("input[memberDelivery*=zipCode]").val("");$("input[memberDelivery*=receiverName]").val("");$("input[memberDelivery*=phone]").val("");$("input[memberDelivery*=mobile]").val("");$("input[memberDelivery*=deliveryId]").val("");$("input[memberDelivery*=pcdCode]").val("");$("input[memberDelivery=province]").val("");$("input[memberDelivery=city]").val("");$("input[memberDelivery=district]").val("");$("#statusCheckbox").removeAttr("checked");$("select[id=province]")[0].selectedIndex=0;$("select[id=city]")[0].selectedIndex=0;$("select[id=district]")[0].selectedIndex=0;$("#area").val("");$("#tel").val("");$("#ext").val("")}function callEditDelivery(c){var e="input[hidedenMemberDelivery*="+c.memberDelivery.id+"zipCode]";var b="input[hidedenMemberDelivery*="+c.memberDelivery.id+"address]";var d="input[hidedenMemberDelivery*="+c.memberDelivery.id+"receiverName]";var a="input[hidedenMemberDelivery*="+c.memberDelivery.id+"phone]";var f="input[hidedenMemberDelivery*="+c.memberDelivery.id+"mobile]";$(e).val(c.memberDelivery.zipCode);$(b).val(c.memberDelivery.address);$(d).val(c.memberDelivery.receiverName);$(a).val(c.memberDelivery.phone);$(f).val(c.memberDelivery.mobile)}function setSellect(a){var b="input[checkName*="+a+"]";$(b).attr("checked","checked")}function addAddress(){idNotAdd=0;if($("input[name=memberDeliveryId]").size()==11){$("#countspan").show();$("input[id=addNewAddress]").attr("disabled","disabled");return}$("#editAddressTable").show();clearForm()}function cancelAddAddress(){$("#editAddressTable").hide();$("#addNewAddress").removeAttr("checked");clearForm();radioClickColor()}var radioVal;function getRadio(){$("input[name*=memberDeliveryId]").each(function(){if($(this).attr("checked")=="checked"){if($(this).val()=="add"){return}radioVal=$(this).val()}})}function radioClickColor(){showUpdate();$("input[name=memberDeliveryId]").each(function(){$(this).parent().css("background","").css("border","");if($(this).attr("checked")=="checked"){if($(this).val()!="add"){$("#editAddressTable").hide()}$(this).parent().css("background","#FFFFE0").css("border","1px solid #F9DFB2")}})}function isAddress(){clearForm();if($("input[name=memberDeliveryId]").size()==1){$("input[id=addNewAddress]").attr("checked","checked");$("span[id=otherAddress]").html("\u65b0\u589e\u6536\u8d27\u5730\u5740");$("#editAddressTable").show();radioClickColor()}else{$("span[id=otherAddress]").html("\u4f7f\u7528\u65b0\u5730\u5740");$("#editAddressTable").hide();radioClickColor()}}function showUpdate(){$("input[name=memberDeliveryId]").each(function(){if($(this).attr("checked")=="checked"){var a=$(this).val();$("span[id=addressSpan"+a+"]").show()}else{var a=$(this).val();$("span[id=addressSpan"+a+"]").hide()}})}function queryAreaLogistics(){var mail=$("input[id=mail]").val();var delivery=$("input[id=delivery]").val();var ems=$("input[id=ems]").val();var freeTemplateId=$("input[id=TemplateId]").val();var areaValue="";var areaName="";if((mail!="0"&&mail!="")||(delivery!="0"&&delivery!="")||(ems!="0"&&ems!="")){$("#tempMethod").html("");$("#temp").html("\u4ee5\u4e0b\u8fd0\u9001\u65b9\u5f0f\u4f9b\u60a8\u9009\u62e9");if(mail!="0"&&mail!=""){$("#tempMethod").append("<li style='float:none'><input type='radio' style='cursor:pointer;' logisticsMode='1' onclick='sumPrice()' name='radioname' value='"+mail+"' checked>\u5e73\u90ae\uff1a"+FormatNumber(eval(mail)/100,2)+"\u5143</li>")}if(delivery!="0"&&delivery!=""){$("#tempMethod").append("<li style='float:none'><input type='radio' style='cursor:pointer;' logisticsMode='2' onclick='sumPrice()' name='radioname' value='"+delivery+"'>\u5feb\u9012\uff1a"+FormatNumber(eval(delivery)/100,2)+"\u5143</li>")}if(ems!="0"&&ems!=""){$("#tempMethod").append("<li style='float:none'><input type='radio' style='cursor:pointer;' logisticsMode='3' onclick='sumPrice()' name='radioname' value='"+ems+"'>EMS\uff1a"+FormatNumber(eval(ems)/100,2)+"\u5143</li>")}}else{if((mail=="0"||mail=="")&&(delivery=="0"||delivery=="")&&(ems=="0"||ems=="")&&(freeTemplateId==""||freeTemplateId=="0")){$("#temp").html("\u5356\u5bb6\u627f\u62c5\u8fd0\u8d39<input type='hidden' id='sell' value='0'>");$("#tempMethod").remove()}else{$("input[name*=memberDeliveryId]").each(function(){if($(this).attr("checked")=="checked"){if($(this).val()=="add"){return}areaValue=$(this).attr("areaValue");areaName=$(this).attr("areaName")}});if(areaValue==""){loadLogisticsDefaultTemp(freeTemplateId,areaName)}else{loadLogisticsTemp(freeTemplateId,areaValue,areaName)}}}}function loadAreaLogistics(){var c=$("input[id=TemplateId]").val();var b;var a;var d;if(c==""||c=="0"){return}$("input[name=memberDeliveryId]").click(function(){var e;$("input[name*=memberDeliveryId]").each(function(){if($(this).attr("checked")=="checked"){if($(this).val()=="add"){e="add";return}b=$(this).val();$("#memberDeliveryId").val(b);a=$(this).attr("areaValue");d=$(this).attr("areaName")}});if(!a||e=="add"){return}if(confirm("\u66f4\u6362\u5730\u5740\u540e\u60a8\u5fc5\u987b\u91cd\u65b0\u786e\u8ba4\u8d2d\u4e70\u4fe1\u606f")){radioVal=b;loadLogisticsTemp(c,a,d)}else{setSellect(radioVal);radioClickColor()}sumPrice()})}function loadLogisticsTemp(freeTemplateId,areaValue,areaName){$("#temp").html("");$("#tempMethod").html("");$.getJSON("/logistics/areaLogisticsAjax.htm",{templateId:freeTemplateId,areaId:areaValue},function(obj){var returnLength=obj.length;if(returnLength>=1){for(var i=0;i<returnLength;i++){var logisticsTypeId=obj[i].logisticsTypeId;var logisticsType;if(logisticsTypeId==1){logisticsType="\u5e73\u90ae"}if(logisticsTypeId==2){logisticsType="\u5feb\u9012"}if(logisticsTypeId==3){logisticsType="EMS"}var post=eval(obj[i].areaCarriage)/100;var much=eval(obj[i].areaCarriageIncrease)/100;$("#temp").html("\uff08\u81f3  "+areaName+"\uff09");$("#tempMethod").append("<li style='float:none'><input type='radio' style='cursor:pointer;' logisticsMode='"+logisticsTypeId+"' onclick='sumPrice()' name='radioname' much='"+obj[i].areaCarriageIncrease+"' value='"+obj[i].areaCarriage+"'>"+logisticsType+"\uff1a"+FormatNumber(post,2)+"\u5143\uff08\u5355\u4ef6\u5546\u54c1"+FormatNumber(post,2)+"\u5143\uff0c\u6bcf\u591a\u52a0\u4e00\u4ef6\u5546\u54c1\u52a0\u6536"+FormatNumber(much,2)+"\u5143\uff09</li>")}var checkName="input[name=radioname]";$(checkName).get(0).checked=true;sumPrice()}else{loadLogisticsDefaultTemp(freeTemplateId,areaName)}})}function loadLogisticsDefaultTemp(freeTemplateId,areaName){$.getJSON("/logistics/logisticsCarriageAjax.htm",{templateId:freeTemplateId},function(obj){for(var i=0;i<obj.length;i++){var logisticsTypeId=obj[i].logisticsTypeId;var logisticsType;if(logisticsTypeId==1){logisticsType="\u5e73\u90ae"}if(logisticsTypeId==2){logisticsType="\u5feb\u9012"}if(logisticsTypeId==3){logisticsType="EMS"}var post=eval(obj[i].defaultCarriage)/100;var much=eval(obj[i].carriageIncrease)/100;if(areaName!=""){$("#temp").html("\uff08\u81f3  "+areaName+"\uff09")}else{$("#temp").html("\u4ee5\u4e0b\u8fd0\u9001\u65b9\u5f0f\u4f9b\u60a8\u9009\u62e9")}$("#tempMethod").append("<li style='float:none'><input type='radio' style='cursor:pointer;' logisticsMode='"+logisticsTypeId+"' onclick='sumPrice()' name='radioname' much='"+obj[i].carriageIncrease+"' value='"+obj[i].defaultCarriage+"'>"+logisticsType+"\uff1a"+FormatNumber(post,2)+"\u5143\uff08\u5355\u4ef6\u5546\u54c1"+FormatNumber(post,2)+"\u5143\uff0c\u6bcf\u591a\u52a0\u4e00\u4ef6\u5546\u54c1\u52a0\u6536"+FormatNumber(much,2)+"\u5143\uff09</li>")}var checkName="input[name=radioname]";$(checkName).get(0).checked=true;sumPrice()})}function selectFavo(){$("select[id=selectFavo]").change(function(){var a=$("select[id=selectFavo]").val();if(a==200){loadShopCoupon()}else{$("select[id=shopCouponSelect]").find("option").remove();$("<option value='0' couponMoney ='0'>\u65e0\u4f18\u60e0</option>").appendTo("select[id=shopCouponSelect]")}sumPrice()})}function sumPrice(){var kuCunNum=$("input[name=kuCunNum]").val();var itemPrice=$("input[name=itemPrice]").val();var guoMaiNum=$("input[id=guoMaiNum]").val();var xianGuoNum=$("input[name=xianGuoNum]").val();var postPrice=0;var favo;var shopCouponPrice=0;var shopCouponTerm=0;var discount=eval($("#dicountRate").val())/1000;var muchPostPrice=0;var logisticsMode=4;$("input[name=radioname]").each(function(){if($(this).attr("checked")=="checked"){postPrice=$(this).attr("value");muchPostPrice=$(this).attr("much");logisticsMode=$(this).attr("logisticsMode")}});var muchPrice=0;if(muchPostPrice){if(eval(guoMaiNum)>1){var num=(eval(guoMaiNum)-1)*eval(muchPostPrice);muchPrice=eval(num)+eval(postPrice)}else{muchPrice=eval(postPrice)}}else{muchPrice=eval(postPrice)}$("#logisticsPrice").val(muchPrice);if(logisticsMode=="4"){$("#logisticsMode").val(4)}else{$("#logisticsMode").val(logisticsMode)}$("select[id=selectFavo]").each(function(){favo=$("select[id=selectFavo]").val()});$("select[id=shopCouponSelect]").each(function(){shopCouponPrice=$(this).find("option:selected").attr("couponMoney");shopCouponTerm=$(this).find("option:selected").attr("term")});if(shopCouponPrice==0||shopCouponTerm==0){$("span[name=shopCouponTip]").html("")}else{$("span[name=shopCouponTip]").html("\u8ba2\u5355\u6ee1"+FormatNumber(shopCouponTerm/100,2)+"\u5143(\u4e0d\u5305\u542b\u90ae\u8d39)")}if(favo=="300"||favo=="400"){if(eval(discount)!=0){var sum=eval(discount)*eval(itemPrice)*eval(guoMaiNum)+eval(muchPrice);$("strong[class=cheng]").html(FormatNumber(eval(sum)/100,2))}else{var sum=(eval(itemPrice)*eval(guoMaiNum)+eval(muchPrice))-eval(shopCouponPrice);$("strong[class=cheng]").html(FormatNumber(eval(sum)/100,2))}if(xianGuoNum!="0"){$("span[id=disNum]").html("\uff08\u9650\u8d2d "+xianGuoNum+" \u4ef6\uff0c\u5e93\u5b58 "+kuCunNum+" \u4ef6\uff09");$("span[name=buyHong]").html("\u9650\u65f6\u6253\u6298\u8ba2\u5355\u5fc5\u987b\u5728\u4e0b\u5355\u540e30\u5206\u949f\u5185\u5b8c\u6210\u652f\u4ed8\uff0c\u8d85\u65f6\u5219\u8ba2\u5355\u5173\u95ed");$("span[name=buyHong]").show()}else{$("span[id=disNum]").html("\uff08\u5e93\u5b58"+kuCunNum+" \u4ef6\uff09");$("span[name=buyHong]").html("");$("span[name=buyHong]").hide()}}else{var sum=(eval(itemPrice)*eval(guoMaiNum)+eval(muchPrice))-eval(shopCouponPrice);$("strong[class=cheng]").html(FormatNumber(eval(sum)/100,2));$("span[id=disNum]").html("\uff08\u5e93\u5b58"+kuCunNum+" \u4ef6\uff09");$("span[name=buyHong]").html("");$("span[name=buyHong]").hide()}}function loadSelect(){var bussinessType=$("#bussinessType").val();var itemPrice=eval($("input[name=itemPrice]").val())/100;var guoMaiNum=$("input[id=guoMaiNum]").val();var discount=eval($("input[id=dicountRate]").val())/1000;$("select[id=selectFavo]").find("option").remove();$("select[id=shopCouponSelect]").find("option").remove();$("<option value='0' couponMoney ='0'>\u65e0\u4f18\u60e0</option>").appendTo("select[id=shopCouponSelect]");if(bussinessType==""||bussinessType=="200"||bussinessType=="100"){$("<option id='disKo' value='200' discount='1' selected>\u65e0\u4f18\u60e0</option>").appendTo("select[id=selectFavo]");loadShopCoupon()}else{if(bussinessType=="300"){var stint=(guoMaiNum*itemPrice)-(eval(itemPrice)*eval(guoMaiNum)*eval(discount));$("<option id='disTime' value='300' selected >\u7701"+FormatNumber(stint,2)+"\u5143:\u9650\u65f6\u6253\u6298</option>").appendTo("select[id=selectFavo]");$("<option id='disKo' value='200' discount='1'>\u65e0\u4f18\u60e0</option>").appendTo("select[id=selectFavo]")}else{if(bussinessType=="400"){if(eval(discount)==0||discount==""){$("<option id='disKo' value='400' discount='1'>\u65e0\u4f18\u60e0</option>").appendTo("select[id=selectFavo]");loadShopCoupon()}else{var stint=(guoMaiNum*itemPrice)-(eval(itemPrice)*eval(guoMaiNum)*eval(discount));$("<option id='disTime' value='400' selected >\u7701"+FormatNumber(stint,2)+"\u5143:\u9650\u65f6\u6253\u6298</option>").appendTo("select[id=selectFavo]");$("<option id='disKo' value='200' discount='1'>\u65e0\u4f18\u60e0</option>").appendTo("select[id=selectFavo]")}}}}}function loadShopCoupon(){var shopId=$("#shopId").val();if(shopId==""||shopId==undefined){return}var itemPrice=$("input[name=itemPrice]").val();var guoMaiNum=$("input[id=guoMaiNum]").val();var discount=eval($("#dicountRate").val())/1000;$("select[id=selectFavo]").each(function(){favo=$("select[id=selectFavo]").val()});var orderSumPrice=0;if(favo=="300"||favo=="400"){if(eval(discount)!=0){orderSumPrice=eval(discount)*eval(itemPrice)*eval(guoMaiNum)}else{orderSumPrice=eval(itemPrice)*eval(guoMaiNum)}}else{orderSumPrice=eval(itemPrice)*eval(guoMaiNum)}$.ajax({type:"post",timeout:10000000,cache:false,dataType:"json",data:{shopId:shopId},async:false,url:"/coupon/buyerAjaxGetCoupon.htm",success:function(data){var dataLength=data.tradeCouponList;$("select[id=shopCouponSelect]").find("option").remove();for(var i=0;i<dataLength.length;i++){var use=dataLength[i].useCondition;if(use==null){use=0}if(eval(orderSumPrice)>=eval(dataLength[i].useCondition)){$("<option value="+dataLength[i].id+" couponMoney ="+dataLength[i].couponMoney+" term="+use+">\u7701"+dataLength[i].couponMoneyByYuan+"\u5143:\u5e97\u94fa\u4f18\u60e0\u5238</option>").appendTo("select[id=shopCouponSelect]")}}$("<option value='0' couponMoney ='0'>\u65e0\u4f18\u60e0</option>").appendTo("select[id=shopCouponSelect]")}})}function FormatNumber(b,c){var b,c;var a,d;b=""+b+"";strLen=b.length;dotPos=b.indexOf(".",0);if(dotPos==-1){a=b+".";for(i=0;i<c;i++){a=a+"0"}return a}else{if((strLen-dotPos-1)>=c){nAfter=dotPos+c+1;d=1;for(j=0;j<c;j++){d=d*10}a=Math.round(parseFloat(b)*d)/d;return a}else{a=b;for(i=0;i<(c-strLen+dotPos+1);i++){a=a+"0"}return a}}}function showTextarea(){$("#showText").show();$("#showText").focus();$("#hideText").hide()}function hideTextarea(){if($("#showText").val()==""){$("#showText").hide();$("#hideText").show()}else{$("#showText").show();$("#hideText").hide()}}function subOrder(){var isCheck=false;var kuCunNum=$("input[name=kuCunNum]").val();var guoMaiNum=$("input[id=guoMaiNum]").val();var xianGuoNum=$("input[name=xianGuoNum]").val();var yiGuoNum=$("#yiGuoNum").val();var checkCode=$("#validateCode").val();var zongNum=eval(guoMaiNum)+eval(yiGuoNum);var leaveWord=$("textarea[id=showText]").val();$("#tipBuyNum").html("");$("#tipBuyNum").hide();var memberDeliveryId;$("input[name*=memberDeliveryId]").each(function(){if($(this).attr("checked")=="checked"){memberDeliveryId=$(this).val()}});var postPrice;$("input[name=radioname]").each(function(){if($(this).attr("checked")=="checked"){postPrice=$(this).attr("value")}});var isDiscount=$("#selectFavo").val();var sell=$("input[id=sell]").val();var canNum=eval(xianGuoNum)-eval(yiGuoNum);if(eval(xianGuoNum)>eval(kuCunNum)&&eval(guoMaiNum)>eval(kuCunNum)){$("#tipBuyNum").html("\u8d2d\u4e70\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e\u5e93\u5b58");$("#tipBuyNum").show();return false}else{if((zongNum>eval(xianGuoNum))&&xianGuoNum!="0"&&yiGuoNum!="0"&&(isDiscount=="300"||isDiscount=="400")){$("#tipBuyNum").html("\u672c\u5546\u54c1\u9650\u8d2d "+xianGuoNum+" \u4ef6\uff0c\u60a8\u5df2\u8d2d\u4e70\u4e86 "+yiGuoNum+" \u4ef6\uff0c\u60a8\u53ea\u80fd\u518d\u8d2d\u4e70 "+canNum+" \u4ef6");$("#tipBuyNum").show();return false}else{if(!memberDeliveryId||memberDeliveryId=="add"){alert("\u8bf7\u9009\u62e9\u6216\u6dfb\u52a0\u201c\u6536\u8d27\u5730\u5740\u201d\uff01");return false}else{if(guoMaiNum==""){alert("\u8bf7\u6b63\u786e\u8f93\u5165\u8d2d\u4e70\u6570\u91cf\uff01");return false}else{if((eval(guoMaiNum)>eval(xianGuoNum))&&xianGuoNum!="0"&&(isDiscount=="300"||isDiscount=="400")){$("#tipBuyNum").html("\u8d2d\u4e70\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e\u9650\u8d2d\u6570\u91cf");$("#tipBuyNum").show();return false}else{if((eval(guoMaiNum)>eval(kuCunNum))&&(isDiscount=="200"||isDiscount=="400")){$("#tipBuyNum").html("\u8d2d\u4e70\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e\u5e93\u5b58");$("#tipBuyNum").show();return false}else{if(!postPrice&&!sell){alert("\u8bf7\u9009\u62e9\u4e00\u79cd\u8fd0\u9001\u65b9\u5f0f\uff01");return false}else{if(leaveWord.length>100){alert("\u7ed9\u5356\u5bb6\u7559\u8a00\u53ea\u80fd\u5728 100 \u4e2a\u5b57\u7b26\u4ee5\u5185\uff01");$("textarea[id=showText]").focus();$("textarea[id=showText]").select();return false}else{if(checkCode==""){alert("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801\uff01");return false}else{if(checkCode.length<4){alert("\u9a8c\u8bc1\u7801\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u5e94\u662f 4 \u4e2a\u5b57\u7b26");return false}else{$("#tipBuyNum").hide();sumPrice();$("#memberDeliveryId").val(memberDeliveryId);isCheck=ajaxCheckCode();if(isCheck){$("#btn").attr("disabled",true);return true}if($("#btn").attr("disabled")=="disabled"){$("#btn").attr("disabled",false)}return false}}}}}}}}}}}var ajaxCheckCode=function(){var a=true;var b=$("#sid").val();var c=$("#validateCode").val();$.ajax({type:"post",timeout:10000000,cache:false,dataType:"json",async:false,url:"${base}/orderBuyer/ajaxcheckcode.htm?sid=".concat(b).concat("&validateCode=").concat(c).concat("&version=").concat(new Date().getTime()),success:function(e){if(e!=null&&e!=""){if(e.error!=undefined){alert(e.error);var d=$("#captcha-img");d.attr("src",d.attr("basesrc")+"&r="+Math.random());a=false}}}});return a};
