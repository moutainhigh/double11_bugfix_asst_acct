function confirmDelivery(m,n){var f=$("input[name='sendDelivery.orderId']").val();var e;var b="input[logisticsName*='"+n+"']";var d=$(b).val();if(m==undefined||m=="undefined"||m==null||m==""){m=$("input[name='logistics.companyId']").val().split("|")[0];e=$("input[name='logistics.companyId']").val().split("|")[1]}else{var j=m.split("|");m=j[0];e=j[1]}var h;$("input[name*=memberDeliveryId]").each(function(){if($(this).attr("checked")=="checked"){h=$(this).val()}});if(h==""||h==undefined||h=="add"){alert("\u8bf7\u9009\u62e9\u53d1\u8d27\u5730\u5740!");return}if(n=="logisticsId"){if($("select[companyName*=logisticsCompany]").val()==""){alert("\u8bf7\u9009\u62e9\u7269\u6d41\u516c\u53f8!");return}}if(d==""){alert("\u8bf7\u8f93\u5165\u8fd0\u5355\u53f7\u7801!");return}var a="${base}/confirmdelivery.htm";var k="${base}/isOrderRefund.htm";var g="?sendDelivery.orderId="+f+"&sendDelivery.outLogisticsId="+d+"&sendDelivery.logisticsType="+m+"&sendDelivery.memberDeliveriesId="+h+"&sendDelivery.consignmentMode="+e;var c=$("#consignmentMode").val();if(c<=3){if(e!=c){alert("\u8bf7\u4f7f\u7528\u4e70\u5bb6\u9009\u62e9\u7684\u7269\u6d41\u65b9\u5f0f\u8fdb\u884c\u53d1\u8d27!");return false}}var l=false;$.ajax({type:"POST",url:k+g,async:false,success:function(o){l=o}});if(l){if(confirm("\u5f3a\u884c\u53d1\u8d27\u5e76\u4e0d\u4f1a\u505c\u6b62\u9000\u6b3e\u7533\u8bf7\uff0c\u5982\u679c\u60a8\u672a\u4e0e\u4e70\u5bb6\u534f\u5546\u4e00\u81f4\uff0c\u8bf7\u4e0d\u8981\u5f3a\u884c\u53d1\u8d27\uff0c\u5426\u5219\u5f88\u53ef\u80fd\u4f1a\u9020\u6210\u60a8\u8d22\u8d27\u635f\u5931")){$.ajax({type:"POST",url:a+g,async:false,success:function(o){if(o=="\u64cd\u4f5c\u6210\u529f"){window.location.href="/orderSeller/ordermanagesell.htm"}else{alert("\u8ba2\u5355\u5df2\u53d1\u8d27\uff01");window.location.href="/orderSeller/ordermanagesell.htm"}}})}}else{$.ajax({type:"POST",url:a+g,async:false,success:function(o){if(o=="\u64cd\u4f5c\u6210\u529f"){window.location.href="/orderSeller/ordermanagesell.htm"}else{alert("\u8ba2\u5355\u5df2\u53d1\u8d27\uff01");window.location.href="/orderSeller/ordermanagesell.htm"}}})}}function defDelivery(){var a=$(":radio:checked").val();$.post("/orderBuyer/setDefDelivery.htm",{deliveryId:a},function(b){$("input[defMd*=defaultmemberDeliveries]").val(a);$("li[defDeliveries*=deliveries] strong").remove();$("li[defDeliveries*=deliveries]").append("<strong></strong>");var c="li[defDeliveries*="+a+"] strong";$("li[defDeliveries*=deliveries] strong").append($(c).html());alert("\u66f4\u65b0\u6210\u529f")})}function defDeliveryByRadio(b,a){$("input[defMd*=defaultmemberDeliveries]").val(a)}function setFormValue(a,b){$("input[name='logistics.companyId']").val(a);$("input[name='logistics.companyName']").val(b)}function delLogisticsById(a){$("input[name='logistics.id']").val(a);$.ajax({type:"post",url:"orderSeller/delLogisticsSellerDeliveryById.htm",data:$("#del").serialize(),cache:false,success:function(b){loadHtml()}})}function isSubmit(){if($("input[name='logistics.companyId']").val()==""){alert("\u8bf7\u9009\u62e9\u7269\u6d41\u516c\u53f8\uff01")}else{$.ajax({type:"post",url:"orderSeller/isLogisticsSellerDevliery.htm",data:$("#add").serialize(),cache:false,success:function(a){if(a=="0"){addLogistics()}else{if(a=="1"){alert("\u7269\u6d41\u4fe1\u606f\u4e0d\u80fd\u8d85\u8fc710\u4e2a")}else{if(a=="2"){alert("\u7269\u6d41\u4fe1\u606f\u5df2\u5b58\u5728")}}}}})}}function addLogistics(){$.ajax({type:"post",url:"orderSeller/addLogisticsSellerDelivery.htm",data:$("#add").serialize(),cache:false,success:function(a){loadHtml()}})}function loadHtml(){var a="<option value=''>\u8bf7\u9009\u62e9</option>";$.ajax({type:"post",url:"orderSeller/getLogisticsCorp.htm",async:false,success:function(b){$.each(b,function(c,d){a+="<option value='"+d.corpCode+"|"+d.logisticsType+"'>"+d.corpName+"</option>"})}});$("#ltab").html("");$("#ltab").append("<tbody><tr class='tr2'><td>\u64cd\u4f5c</td><td>\u7269\u6d41\u516c\u53f8</td><td>\u8f93\u5165\u8fd0\u5355\u53f7\u7801</td><td>\u786e\u8ba4\u53d1\u8d27</td></tr><tr><td onclick='isSubmit();'><a herf='##' style='cursor:pointer'>\u8bbe\u4e3a\u9ed8\u8ba4</a></td><td><select style='width:150px;' companyName='logisticsCompany' onchange='setFormValue(this.value,this.options[this.selectedIndex].text)'>"+a+"</select></td><td><input type='text' logisticsName='logisticsId' maxlength='50'/></td><td><input type='button' class='pl-btn-juse'  style='cursor:pointer' onclick=\"confirmDelivery("+$("select").val()+",'logisticsId');\" value='\u786e\u8ba4\u53d1\u8d27' /></td></tr></tbody>");$.ajax({type:"post",url:"orderSeller/queryByMemberId.htm",cache:false,success:function(b){$.each(b,function(c,d){$("#ltab").append("<tr><td onclick='delLogisticsById("+d.id+")'><a herf='##' style='cursor:pointer'>\u53d6\u6d88\u9ed8\u8ba4</a></td><td>"+d.companyName+"</td><td><input type='text' logisticsName='logisticsId"+c+"' maxlength='50'/></td><td><input type='button' class='pl-btn-juse'  style='cursor:pointer' onclick=\"confirmDelivery('"+d.companyId+"|"+d.logisticsType+"','logisticsId"+c+"');\" value='\u786e\u8ba4\u53d1\u8d27'/></td>")})}})}var idNotAdd;function editAddress(a,b){idNotAdd=1;setEditValue(a,b);link.setValue(b);$("#editAddressTable").show()}function defAddress(a,b){setEditValue(a,b);link.setValue(b);$("#statusCheckbox").attr("checked","checked");submitEditDelivery(2)}function setEditValue(f,k){var h="input[hidedenMemberDelivery*="+f+"zipCode]";var c="input[hidedenMemberDelivery*="+f+"address]";var l="input[hidedenMemberDelivery*="+f+"receiverName]";var a="input[hidedenMemberDelivery*="+f+"phone]";var g="input[hidedenMemberDelivery*="+f+"mobile]";var m="input[hidedenMemberDelivery*="+f+"province]";var e="input[hidedenMemberDelivery*="+f+"city]";var d="input[hidedenMemberDelivery*="+f+"district]";var o="input[hidedenMemberDelivery*="+f+"status]";$("textarea[memberDelivery*=address]").val($(c).val());$("input[memberDelivery*=zipCode]").val($(h).val());$("input[memberDelivery*=receiverName]").val($(l).val());$("input[memberDelivery*=phone]").val($(a).val());$("input[memberDelivery*=mobile]").val($(g).val());$("input[memberDelivery*=deliveryId]").val(f);$("input[memberDelivery*=pcdCode]").val(k);$("input[memberDelivery=province]").val($(m).val());$("input[memberDelivery=city]").val($(e).val());$("input[memberDelivery=district]").val($(d).val());if($(o).val()=="1"){$("#statusCheckbox").attr("checked","checked")}else{$("#statusCheckbox").removeAttr("checked")}var j=$(a).val();$("#area").val("");$("#tel").val("");$("#ext").val("");var b=/(?:\((\d+)\))?(\d+)?(?:\*(\d+))?/g.exec(j);if(!b){return}$("#area").val(b[1]);$("#tel").val(b[2]);$("#ext").val(b[3])}function submitEditDelivery(o){if(idNotAdd==0){if($("input[name=memberDeliveryId]").size()==11){$("#countspan").show();return}}var k=$("input[memberDelivery=receiverName]").val();var p=$("textarea[memberDelivery=address]").val();var a=$("input[memberDelivery=zipCode]").val();var m=$("#tel").val();var c=$("#area").val();var b=$("input[memberDelivery=mobile]").val();var d=$("#ext").val();var e=$("select[id=province]").val();var j=$("select[id=city]").val();var q=$("select[id=district]").val();if(k==""){alert("\u6536\u8d27\u4eba\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(k.length<2||k.length>20){alert("\u6536\u8d27\u4eba\u59d3\u540d\u5e94\u5728 2 \u5230 20 \u4e2a\u5b57\u7b26\u4e4b\u95f4\uff01");return}if((e==null||e=="-1")&&(j==null||j=="-1")){alert("\u7701\u4efd\u3001\u57ce\u5e02\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(e==null||e=="-1"){alert("\u7701\u4efd\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(j==null||j=="-1"){alert("\u57ce\u5e02\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(p==""){alert("\u8857\u9053\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(p.length>200){alert("\u8857\u9053\u5730\u5740\u5e94\u5728 200 \u4e2a\u5b57\u7b26\u4ee5\u5185\uff01");return}if(a==""){alert("\u90ae\u653f\u7f16\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}var h=/^(?:(?:0[1-7]|[1-8][0-9])[0-9]{4})?$/;if(!h.test(a)){alert("\u90ae\u653f\u7f16\u7801\u683c\u5f0f\u4e0d\u6b63\u786e\uff01");return}if(b==""&&m==""){alert("\u8bf7\u8f93\u7535\u8bdd\u53f7\u7801\u6216\u624b\u673a\u53f7\u7801\uff01");$("#area").focus();return}var l=/^(?:0[1-9][0-9][0-9]?)?$/;if(c!=""){if(!l.test(c)){alert("\u533a\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e\uff01");return}}var r=/^(\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$/;var n=/^(?:1[3458][0-9]{9})$/;if(m!=""){if(!r.test(m)){alert("\u7535\u8bdd\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e");return}}var g=/^(?:[0-9]{1,8})?$/;if(g!=""){if(!g.test(d)){alert("\u5206\u673a\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e\uff01");return}}if(b!=""){if(!n.test(b)){alert("\u624b\u673a\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e");return}}var f=$("#editAddFrom").serializeArray();$.post("/orderBuyer/orderDelivery.htm?k=Math.Random()",f,function(s){updateId=s.memberDelivery.id;loadAddress();$("#editAddressTable").hide();clearAddressForm()})}function checkAddress(){if($("input[name=memberDeliveryId]").size()==11){$("#countspan").show();$("input[id=addNewAddress]").attr("disabled","disabled")}}function loadAddress(){$.getJSON("/orderBuyer/loadAddressAjax.htm?x=Math.Random()",function(b){if(b.deliveries.length<=0){isAddress();return}$("#myTab").html("");for(i in b.deliveries){var a="";a+="<li>";a+="<input name='memberDeliveryId' checkName="+b.deliveries[i].id+" areaName="+b.deliveries[i].province+" areaValue="+b.deliveries[i].pcdCode+" type='radio' value="+b.deliveries[i].id+" style='cursor:pointer;' onclick='radioClickColor()' title='\u9009\u62e9\u5730\u5740'/>";a+=encode(b.deliveries[i].receiverName)+"&nbsp;&nbsp;&nbsp;&nbsp;";a+=b.deliveries[i].province+"&nbsp;";a+=b.deliveries[i].city+"&nbsp;";a+=b.deliveries[i].district;a+=encode(b.deliveries[i].address)+"\uff0c";a+=b.deliveries[i].zipCode;if(b.deliveries[i].phone!=null&&b.deliveries[i].mobile!=null){a+="\uff0c"+b.deliveries[i].phone+"\uff0c"+b.deliveries[i].mobile}else{if(b.deliveries[i].phone!=null&&b.deliveries[i].mobile==null){a+="\uff0c"+b.deliveries[i].phone}else{if(b.deliveries[i].phone==null&&b.deliveries[i].mobile!=null){a+="\uff0c"+b.deliveries[i].mobile}}}if(b.deliveries[i].status==1){a+='<span style="color:red">\uff08\u9ed8\u8ba4\uff09</span>'}a+='&nbsp;&nbsp;&nbsp;&nbsp;<span style="display:none;" id="addressSpan'+b.deliveries[i].id+'"><a href="#" class="lan" onmousedown="editAddress('+b.deliveries[i].id+","+b.deliveries[i].pcdCode+');" title="\u70b9\u51fb\u540e\u7f16\u8f91\u6846\u4e2d\u8fdb\u884c\u4fee\u6539">\u4fee\u6539</a>';if(b.deliveries[i].status==0){a+='<span style="margin-left:10px"><a href="#" class="lan" onmousedown="defAddress('+b.deliveries[i].id+","+b.deliveries[i].pcdCode+');" title="\u5c06\u6b64\u6761\u5730\u5740\u8bbe\u4e3a\u9ed8\u8ba4\u6536\u8d27\u5730\u5740">&nbsp;&nbsp;\u8bbe\u4e3a\u9ed8\u8ba4</a></span>'}a+="</span>";a+='<input type="hidden" value="'+b.deliveries[i].zipCode+'" hidedenMemberDelivery="'+b.deliveries[i].id+'zipCode"/>';a+='<input type="hidden" value="'+encode(b.deliveries[i].address)+'" hidedenMemberDelivery="'+b.deliveries[i].id+'address"/>';a+='<input type="hidden" value="'+encode(b.deliveries[i].receiverName)+'" hidedenMemberDelivery="'+b.deliveries[i].id+'receiverName"/>';a+='<input type="hidden" value="'+b.deliveries[i].status+'" hidedenMemberDelivery="'+b.deliveries[i].id+'status"/>';a+='<input type="hidden" value="'+b.deliveries[i].phone+'" hidedenMemberDelivery="'+b.deliveries[i].id+'phone"/>';a+='<input type="hidden" value="'+b.deliveries[i].mobile+'" hidedenMemberDelivery="'+b.deliveries[i].id+'mobile"/>';a+='<input type="hidden" value="'+b.deliveries[i].province+'" hidedenMemberDelivery="'+b.deliveries[i].id+'province"/>';a+='<input type="hidden" value="'+b.deliveries[i].city+'" hidedenMemberDelivery="'+b.deliveries[i].id+'city"/>';a+='<input type="hidden" value="'+b.deliveries[i].district+'" hidedenMemberDelivery="'+b.deliveries[i].id+'district"/>';a+="</li>";$("#myTab").append(a)}isAddress();setSellect(updateId);checkAddress();radioClickColor()})}var ENCODE=[{reg:/&/g,rep:"&amp;"},{reg:/</g,rep:"&lt;"},{reg:/>/g,rep:"&gt;"},{reg:/"/g,rep:"&quot;"},{reg:/ /g,rep:"&nbsp;"}];function encode(b){for(var a=0;a<ENCODE.length;a++){b=b.replace(ENCODE[a]["reg"],ENCODE[a]["rep"])}return b}function setSellect(a){var b="input[checkName*="+a+"]";$(b).attr("checked","checked")}function clearAddressForm(){$("textarea[memberDelivery*=address]").val("");$("input[memberDelivery*=zipCode]").val("");$("input[memberDelivery*=receiverName]").val("");$("input[memberDelivery*=phone]").val("");$("input[memberDelivery*=mobile]").val("");$("input[memberDelivery*=deliveryId]").val("");$("input[memberDelivery*=pcdCode]").val("");$("input[memberDelivery=province]").val("");$("input[memberDelivery=city]").val("");$("input[memberDelivery=district]").val("");$("select[id=province]")[0].selectedIndex=0;$("select[id=city]")[0].selectedIndex=0;$("select[id=district]")[0].selectedIndex=0;$("#statusCheckbox").removeAttr("checked");$("#area").val("");$("#tel").val("");$("#ext").val("")}function cancelAddAddress(){$("#editAddressTable").hide();$("#addNewAddress").removeAttr("checked");clearAddressForm()}function radioClickColor(){showUpdate();$("input[name=memberDeliveryId]").each(function(){$(this).parent().css("background","").css("border","");if($(this).attr("checked")=="checked"){if($(this).val()!="add"){$("#editAddressTable").hide()}$(this).parent().css("background","#FFFFE0").css("border","1px solid #F9DFB2")}})}function addAddress(){$("#editAddressTable").show();clearAddressForm()}function showUpdate(){$("input[name=memberDeliveryId]").each(function(){if($(this).attr("checked")=="checked"){var a=$(this).val();$("span[id=addressSpan"+a+"]").show()}else{var a=$(this).val();$("span[id=addressSpan"+a+"]").hide()}})}function isAddress(){clearAddressForm();if($("input[name=memberDeliveryId]").size()==1){$("input[id=addNewAddress]").attr("checked","checked");$("span[id=otherAddress]").html("\u65b0\u589e\u53d1\u8d27\u5730\u5740");$("#editAddressTable").show();radioClickColor()}else{$("span[id=otherAddress]").html("\u4f7f\u7528\u65b0\u5730\u5740");$("#editAddressTable").hide();radioClickColor()}}$(document).ready(function(){loadHtml();if(document.getElementById("addNewAddress").checked){$("#editAddressTable").css("display","block")}else{$("#editAddressTable").css("display","none")}link=$("#province, #city, #district").linkage(pcd,{debug:true,links:$("#mprovince, #mcity, #mdistrict"),lastLink:"#mpcdCode"});showUpdate();radioClickColor();checkAddress();isAddress()});
