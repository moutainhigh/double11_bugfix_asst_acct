jQuery(document).ready(function($){link=$("#province, #city, #district").linkage(pcd,{debug:true,links:$("#mprovince, #mcity, #mdistrict"),lastLink:"#mpcdCode"});loadLogisticsTemp();var orderCreationPrice=$("input[orderCreationPrice*=orderCreationPrice]");var buyNum=$("input[buyNum*=buyNum]");var sumPrice=0;var sumLogisticsPrice=eval($("input[id=sumLogisticsPrice]").val());for(var i=0;i<orderCreationPrice.length;i++){var num=Number(buyNum[i].value);var price=Number(orderCreationPrice[i].value);sumPrice=eval(sumPrice)+num*price}$("#sumPrice").html(FormatNumber(sumPrice,2));$("input[id=sumPriceItem]").val(sumPrice);$("#anywayPrice").html(FormatNumber(sumPrice+sumLogisticsPrice,2));callCarriage();radioClickColor();isAddress();radioClick();showUpdate()});function loadAddress(){$.getJSON("/orderBuyer/loadAddressAjax.htm?x=Math.Random()",function(b){if(b.deliveries.length<=0){isAddress();return}$("#myTab").html("");var a="";a+="<ul>";for(i in b.deliveries){a+="<li>";a+="<input name='memberDeliveryId' checkName="+b.deliveries[i].id+" areaValue="+b.deliveries[i].pcdCode+" type='radio' value="+b.deliveries[i].id+" style='cursor:pointer;' onclick='radioClickColor()' title='\u9009\u62e9\u5730\u5740'/>";a+="&nbsp;"+encode(b.deliveries[i].receiverName)+"\uff0c&nbsp;&nbsp;";a+="&nbsp;"+b.deliveries[i].province;a+="\uff0c"+b.deliveries[i].city;a+="\uff0c&nbsp;"+b.deliveries[i].district;a+="\uff0c"+encode(b.deliveries[i].address);a+="\uff0c&nbsp;"+b.deliveries[i].zipCode;if(b.deliveries[i].phone!=null&&b.deliveries[i].mobile!=null){a+="\uff0c&nbsp;"+b.deliveries[i].phone+"\uff0c"+b.deliveries[i].mobile}else{if(b.deliveries[i].phone!=null&&b.deliveries[i].mobile==null){a+="\uff0c&nbsp;"+b.deliveries[i].phone}else{if(b.deliveries[i].phone==null&&b.deliveries[i].mobile!=null){a+="\uff0c&nbsp;"+b.deliveries[i].mobile}}}if(b.deliveries[i].status==1){a+='&nbsp;&nbsp;<span style="color:red">\uff08\u9ed8\u8ba4\uff09</span>'}a+='<span style="display:none;" id="addressSpan'+b.deliveries[i].id+'">&nbsp;&nbsp;<a href="#" class="lan" onmousedown="editAddress('+b.deliveries[i].id+","+b.deliveries[i].pcdCode+');" title="\u70b9\u51fb\u540e\u7f16\u8f91\u6846\u4e2d\u8fdb\u884c\u4fee\u6539">\u4fee\u6539</a>';if(b.deliveries[i].status==0){a+='&nbsp;&nbsp;<a href="#" class="lan" onmousedown="defAddress('+b.deliveries[i].id+","+b.deliveries[i].pcdCode+');" title="\u5c06\u6b64\u6761\u5730\u5740\u8bbe\u4e3a\u9ed8\u8ba4\u6536\u8d27\u5730\u5740">&nbsp;&nbsp;\u8bbe\u4e3a\u9ed8\u8ba4</a>'}a+="</span>";a+='<input type="hidden" value="'+b.deliveries[i].zipCode+'" hidedenMemberDelivery="'+b.deliveries[i].id+'zipCode"/>';a+='<input type="hidden" value="'+encode(b.deliveries[i].address)+'" hidedenMemberDelivery="'+b.deliveries[i].id+'address"/>';a+='<input type="hidden" value="'+encode(b.deliveries[i].receiverName)+'" hidedenMemberDelivery="'+b.deliveries[i].id+'receiverName"/>';a+='<input type="hidden" value="'+b.deliveries[i].status+'" hidedenMemberDelivery="'+b.deliveries[i].id+'status"/>';a+='<input type="hidden" value="'+b.deliveries[i].phone+'" hidedenMemberDelivery="'+b.deliveries[i].id+'phone"/>';a+='<input type="hidden" value="'+b.deliveries[i].mobile+'" hidedenMemberDelivery="'+b.deliveries[i].id+'mobile"/>';a+='<input type="hidden" value="'+b.deliveries[i].province+'" hidedenMemberDelivery="'+b.deliveries[i].id+'province"/>';a+='<input type="hidden" value="'+b.deliveries[i].city+'" hidedenMemberDelivery="'+b.deliveries[i].id+'city"/>';a+='<input type="hidden" value="'+b.deliveries[i].district+'" hidedenMemberDelivery="'+b.deliveries[i].id+'district"/>';a+="</li>"}a+="</ul>";$("#myTab").append(a);showUpdate();isAddress();setSellect(updateId);radioClickColor();loadLogisticsTemp();radioClick()})}var ENCODE=[{reg:/&/g,rep:"&amp;"},{reg:/</g,rep:"&lt;"},{reg:/>/g,rep:"&gt;"},{reg:/"/g,rep:"&quot;"},{reg:/ /g,rep:"&nbsp;"}];function encode(b){for(var a=0;a<ENCODE.length;a++){b=b.replace(ENCODE[a]["reg"],ENCODE[a]["rep"])}return b}var idNotAdd;var updateId;function editAddress(a,b){updateId=a;idNotAdd=1;setEditValue(a,b);link.setValue(b);$("#editAddressTable").show()}function defAddress(a,b){setEditValue(a,b);link.setValue(b);$("#statusCheckbox").attr("checked","true");submitEditDelivery(2)}function setEditValue(f,l){var h="input[hidedenMemberDelivery*="+f+"zipCode]";var c="input[hidedenMemberDelivery*="+f+"address]";var m="input[hidedenMemberDelivery*="+f+"receiverName]";var a="input[hidedenMemberDelivery*="+f+"phone]";var g="input[hidedenMemberDelivery*="+f+"mobile]";var o="input[hidedenMemberDelivery*="+f+"province]";var e="input[hidedenMemberDelivery*="+f+"city]";var d="input[hidedenMemberDelivery*="+f+"district]";var p="input[hidedenMemberDelivery*="+f+"status]";$("textarea[memberDelivery*=address]").val($(c).val());$("input[memberDelivery*=zipCode]").val($(h).val());$("input[memberDelivery*=receiverName]").val($(m).val());$("input[memberDelivery*=phone]").val($(a).val());$("input[memberDelivery*=mobile]").val($(g).val());$("input[memberDelivery*=deliveryId]").val(f);$("input[memberDelivery*=pcdCode]").val(l);$("input[memberDelivery=province]").val($(o).val());$("input[memberDelivery=city]").val($(e).val());$("input[memberDelivery=district]").val($(d).val());if($(p).val()=="1"){$("#statusCheckbox").attr("checked","true")}else{$("#statusCheckbox").removeAttr("checked")}var k=$(a).val();$("#area").val("");$("#tel").val("");$("#ext").val("");var b=/(?:\((\d+)\))?(\d+)?(?:\*(\d+))?/g.exec(k);if(!b){return}$("#area").val(b[1]);$("#tel").val(b[2]);$("#ext").val(b[3])}function submitEditDelivery(p){if(idNotAdd==0){if($("input[name=memberDeliveryId]")==11){$("span[id=countspan]").css("display","block");return}}var l=$("input[memberDelivery=receiverName]").val();l=l.replace(/\s+/g,"");var q=$("textarea[memberDelivery=address]").val();q=q.replace(/\s+/g,"");var a=$("input[memberDelivery=zipCode]").val();var n=$("#tel").val();var c=$("#area").val();var b=$("input[memberDelivery=mobile]").val();var d=$("#ext").val();var e=$("select[id=province]").val();var k=$("select[id=city]").val();var r=$("select[id=district]").val();if(l==""){alert("\u6536\u8d27\u4eba\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(l.length<2||l.length>20){alert("\u6536\u8d27\u4eba\u59d3\u540d\u5e94\u5728 2 \u5230 20 \u4e2a\u5b57\u7b26\u4e4b\u95f4\uff01");return}if((e==null||e=="-1")&&(k==null||k=="-1")){alert("\u7701\u4efd\u3001\u57ce\u5e02\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(e==null||e=="-1"){alert("\u7701\u4efd\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(k==null||k=="-1"){alert("\u57ce\u5e02\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(q==""){alert("\u8857\u9053\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}if(q.length>=200){alert("\u8857\u9053\u5730\u5740\u5e94\u5728 200 \u4e2a\u5b57\u7b26\u4ee5\u5185\uff01");return}if(a==""){alert("\u90ae\u653f\u7f16\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01");return}var h=/^(?:(?:0[1-7]|[1-8][0-9])[0-9]{4})?$/;if(!h.test(a)){alert("\u90ae\u653f\u7f16\u7801\u683c\u5f0f\u4e0d\u6b63\u786e\uff01");return}if(b==""&&n==""){alert("\u8bf7\u8f93\u7535\u8bdd\u53f7\u7801\u6216\u624b\u673a\u53f7\u7801\uff01");return}var m=/^(?:0[1-9][0-9][0-9]?)?$/;if(c!=""){if(!m.test(c)){alert("\u533a\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e\uff01");return}}var s=/^(?:[1-9][0-9]{5,7})?$/;var o=/^(?:1[3458][0-9]{9})$/;if(n!=""){if(!s.test(n)){alert("\u7535\u8bdd\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e");return}}var g=/^(?:[0-9]{1,8})?$/;if(g!=""){if(!g.test(d)){alert("\u5206\u673a\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e\uff01");return}}if(b!=""){if(!o.test(b)){alert("\u624b\u673a\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e");return}}var f=$("#editAddFrom").serializeArray();$.post("/orderBuyer/orderDelivery.htm",f,function(t){alert(t.resultMessage);updateId=t.memberDelivery.id;loadAddress();$("#editAddressTable").hide();clearForm()})}function clearForm(){$("textarea[memberDelivery*=address]").val("");$("input[memberDelivery*=zipCode]").val("");$("input[memberDelivery*=receiverName]").val("");$("input[memberDelivery*=phone]").val("");$("input[memberDelivery*=mobile]").val("");$("input[memberDelivery*=deliveryId]").val("");$("input[memberDelivery*=pcdCode]").val("");$("input[memberDelivery=province]").val("");$("input[memberDelivery=city]").val("");$("input[memberDelivery=district]").val("");$("#statusCheckbox").removeAttr("checked");$("select[id=province]")[0].selectedIndex=0;$("select[id=city]")[0].selectedIndex=0;$("select[id=district]")[0].selectedIndex=0;$("#area").val("");$("#tel").val("");$("#ext").val("")}function setSellect(a){var b="input[checkName*="+a+"]";$(b).attr("checked","checked")}function addAddress(){idNotAdd=0;if($("input[name=memberDeliveryId]").size()==11){$("span[id=countspan]").show();$("input[id=addNewAddress]").attr("disabled","disabled");return}$("#editAddressTable").show();clearForm()}function radioClickColor(){showUpdate();$("input[name*=memberDeliveryId]").each(function(){$(this).parent().css("background","").css("border","");if($(this).attr("checked")=="checked"){if($(this).val()!="add"){$("#editAddressTable").hide()}$(this).parent().css("background","#FFFFE0").css("border","1px solid #F9DFB2")}})}function cancelAddAddress(){$("#editAddressTable").hide();$("#addNewAddress").removeAttr("checked");clearForm();radioClickColor()}function isAddress(){clearForm();if($("input[name=memberDeliveryId]").size()==1){$("input[id=addNewAddress]").attr("checked","checked");$("span[id=otherAddress]").html("\u65b0\u589e\u6536\u8d27\u5730\u5740");$("#editAddressTable").show();radioClickColor()}else{$("span[id=otherAddress]").html("\u4f7f\u7528\u65b0\u5730\u5740");$("#editAddressTable").hide();radioClickColor()}}function showUpdate(){$("input[name*=memberDeliveryId]").each(function(){if($(this).attr("checked")=="checked"){var a=$(this).val();$("span[id=addressSpan"+a+"]").show()}else{var a=$(this).val();$("span[id=addressSpan"+a+"]").hide()}})}function loadLogisticsTemp(){var myLi=$("div[id=myLi]");var postPrice;var deliveryPrice;var emsPrice;var templateId;var selectParam;var muchShopsId="?";var orderPrice="";var itemId="";for(var i=0;i<myLi.length;i++){postPrice=$(myLi[i]).find("input[id=postPrice]").val();deliveryPrice=$(myLi[i]).find("input[id=deliveryPrice]").val();emsPrice=$(myLi[i]).find("input[id=emsPrice]").val();templateId=$(myLi[i]).find("input[id=templateId]").val();selectParam=$(myLi[i]).find("input[id=paramId]").val();id=$(myLi[i]).find("input[id=shopId]").val();muchShopsId+="&muchShopsId=".concat(id);orderPrice+=$(myLi[i]).find("input[id=itemPrice]").val()+";";itemId+=$(myLi[i]).find("input[id=itemId]").val()+";";$("select[id=select"+selectParam+"]").remove();if((postPrice!="0"&&postPrice!="")||(deliveryPrice!="0"&&deliveryPrice!="")||(emsPrice!="0"&&emsPrice!="")){var select="<select area='changes' id='select"+selectParam+"' onchange='callCarriage()'>";if(postPrice!="0"&&postPrice!=""){select+="<option value='"+postPrice+"' much='0' logisticsMode='1'>\u5e73\u90ae\uff1a\uffe5"+FormatNumber(eval(postPrice)/100,2)+"\u5143</option>"}if(deliveryPrice!="0"&&deliveryPrice!=""){select+="<option value='"+deliveryPrice+"' much='0' logisticsMode='2'>\u5feb\u9012\uff1a\uffe5"+FormatNumber(eval(deliveryPrice)/100,2)+"\u5143</option>"}if(emsPrice!="0"&&emsPrice!=""){select+="<option value='"+emsPrice+"' much='0' logisticsMode='3'>EMS\uff1a\uffe5"+FormatNumber(eval(emsPrice)/100,2)+"\u5143</option>"}select+="</select>";$(select).appendTo($("div[id=mySelect"+selectParam+"]"))}else{if(templateId!=""&&templateId!="0"){var selectIdCurrent=$(myLi[i]).find("input[id=paramId]").val();var areaValue="";$("input[name*=memberDeliveryId]").each(function(){if($(this).attr("checked")=="checked"){areaValue=$(this).attr("areaValue")}});if(areaValue=="add"){return}var tempIdCurrent=$(myLi[i]).find("input[id=templateId]").val();if(areaValue==""){loadLogisDefaultTemp(tempIdCurrent,selectIdCurrent)}else{loadAddressLogsTemp(tempIdCurrent,areaValue,selectIdCurrent)}}else{if((postPrice=="0"||postPrice=="")&&(deliveryPrice=="0"||deliveryPrice=="")&&(emsPrice=="0"||emsPrice=="")&&(templateId=="0"||templateId=="")){var select="<select area='changes' id='select"+selectParam+"' onchange='callCarriage()'>";select+="<option value='0' much='0' logisticsMode='4'>\u5356\u5bb6\u627f\u62c5\u8fd0\u8d39</option>";select+="</select>";$(select).appendTo($("div[id=mySelect"+selectParam+"]"))}}}}loadShopCoupon(muchShopsId)}function loadAddressLogsTemp(tempIdCurrent,areaValue,selectIdCurrent){$.getJSON("/logistics/areaLogisticsAjax.htm",{templateId:tempIdCurrent,areaId:areaValue,x:Math.random()},function(obj){var returnLength=obj.length;if(returnLength>=1){var selectOption="";selectOption+="<select area='changes' id='select"+selectIdCurrent+"' onchange='callCarriage()'>";for(var i=0;i<returnLength;i++){var logisticsTypeId=obj[i].logisticsTypeId;var logisticsType;var logisticsMode;if(logisticsTypeId==1){logisticsType="\u5e73\u90ae";logisticsMode="1"}if(logisticsTypeId==2){logisticsType="\u5feb\u9012";logisticsMode="2"}if(logisticsTypeId==3){logisticsType="EMS";logisticsMode="3"}var post=eval(obj[i].areaCarriage)/100;var much=eval(obj[i].areaCarriageIncrease)/100;var Newpost=eval(obj[i].areaCarriage);selectOption+="<option value='"+Newpost+"' much='"+obj[i].areaCarriageIncrease+"' logisticsMode ='"+logisticsMode+"'>"+logisticsType+"\uff1a\uffe5"+FormatNumber(post,2)+"\u5143\uff08\u5355\u4ef6\u5546\u54c1"+FormatNumber(post,2)+"\u5143\uff0c\u6bcf\u591a\u52a0\u4e00\u4ef6\u5546\u54c1\u52a0\u6536"+FormatNumber(much,2)+"\u5143\uff09</option>"}selectOption+="</select>";$(selectOption).appendTo($("div[id=mySelect"+selectIdCurrent+"]"));callCarriage()}else{loadLogisDefaultTemp(tempIdCurrent,selectIdCurrent)}})}function loadLogisDefaultTemp(tempIdCurrent,selectIdCurrent){$.getJSON("/logistics/logisticsCarriageAjax.htm",{templateId:tempIdCurrent,x:Math.random()},function(obj){var selectOption="";selectOption+="<select area='changes' id='select"+selectIdCurrent+"' onchange='callCarriage()'>";for(var i=0;i<obj.length;i++){var logisticsTypeId=obj[i].logisticsTypeId;var logisticsType;var logisticsMode;if(logisticsTypeId==1){logisticsType="\u5e73\u90ae";logisticsMode="1"}if(logisticsTypeId==2){logisticsType="\u5feb\u9012";logisticsMode="2"}if(logisticsTypeId==3){logisticsType="EMS";logisticsMode="3"}var post=eval(obj[i].defaultCarriage)/100;var much=eval(obj[i].carriageIncrease)/100;var Newpost=eval(obj[i].defaultCarriage);selectOption+="<option value='"+Newpost+"' much='"+obj[i].carriageIncrease+"' logisticsMode ='"+logisticsMode+"'>"+logisticsType+"\uff1a\uffe5"+FormatNumber(post,2)+"\u5143\uff08\u5355\u4ef6\u5546\u54c1"+FormatNumber(post,2)+"\u5143\uff0c\u6bcf\u591a\u52a0\u4e00\u4ef6\u5546\u54c1\u52a0\u6536"+FormatNumber(much,2)+"\u5143\uff09</option>"}selectOption+="</select>";$(selectOption).appendTo($("div[id=mySelect"+selectIdCurrent+"]"));callCarriage()})}function radioClick(){$("input[name=memberDeliveryId]").click(function(){if($(this).attr("checked")=="checked"){if($(this).val()=="add"){return}loadLogisticsTemp()}})}function callCarriage(){var carriagePrice=0;var muchPrice=0;$("select[area=changes]").each(function(){muchPrice=eval($(this).find("option:selected").attr("much"));var id=$(this).attr("id");var selectid=$("select[id="+id+"]").parent().attr("id");var num=$("div[id="+selectid+"]").find("input[id="+selectid+"]").val();if(eval(num)>1){var sums=(eval(num)-1)*eval(muchPrice);carriagePrice=carriagePrice+eval(sums)/100;var sumPrice=eval($(this).val())+eval(sums);$("input[id="+selectid+"Price]").val(sumPrice)}else{$("input[id="+selectid+"Price]").val($(this).val())}$("input[id="+selectid+"Mode]").val($(this).find("option:selected").attr("logisticsMode"));carriagePrice+=eval($(this).val()/100)});var shopCouponPrice=0;var selectboxList=$(".shopCoupinClass");selectboxList.each(function(){shopCouponPrice+=eval($(this).find("option:selected").attr("couponMoney"))});$("span[id=carriagePrice]").html("\uffe5"+FormatNumber(carriagePrice,2));$("input[id=sumLogisticsPrice]").val(carriagePrice);var sumPriceItem=eval($("input[id=sumPriceItem]").val());var sumLogisticsPrice=eval($("input[id=sumLogisticsPrice]").val());var anywayPrice=(sumPriceItem+sumLogisticsPrice)-(eval(shopCouponPrice)/100);$("#anywayPrice").html(FormatNumber(anywayPrice,2))}function loadShopCoupon(muchShopsId){var allCouponMap;var selectboxList=$(".shopCoupinClass");$.ajax({type:"post",timeout:15000,cache:false,dataType:"json",async:false,url:"/coupon/shopCoupon.htm".concat(muchShopsId),success:function(data){allCouponMap=data.tradeCouponMap;selectboxList.each(function(i){var couponList=allCouponMap[$(this).attr("data-shop-id")];var price=$(this).attr("price");$(this).find("option").remove();for(var i=0;i<couponList.length;i++){var use=couponList[i].useCondition;if(use==null){use=0}if(eval(couponList[i].useCondition)<=eval(price)){$("<option couponid="+couponList[i].id+" value="+couponList[i].id+" couponMoney="+couponList[i].couponMoney+" term="+use+">\u7701"+couponList[i].couponMoneyByYuan+"\u5143:\u5e97\u94fa\u4f18\u60e0\u5238</option>").appendTo(this)}}$("<option couponid='0' value='0' couponMoney='0'>\u65e0\u4f18\u60e0</option>").appendTo(this)})}});function changeOption(){var self=this;var id=$(this).attr("data-shop-id");var couponList=allCouponMap[id];var selectedCouponId={};selectboxList.each(function(){var option=$(this).find("option:selected");if(option&&option.attr("couponid")){selectedCouponId[option.attr("couponid")]=true}});selectboxList.each(function(){if(self==this){return}if($(this).attr("data-shop-id")!=id){return}var value=this.value;if(selectedCouponId[value]){delete selectedCouponId[value]}var price=$(this).attr("price");$(this).find("option").remove();for(var i=0;i<couponList.length;i++){var couponId=couponList[i].id;if(!selectedCouponId[couponId]){var use=couponList[i].useCondition;if(use==null){use=0}if(eval(couponList[i].useCondition)<=eval(price)){$("<option couponid="+couponId+" value="+couponId+" couponMoney="+couponList[i].couponMoney+" term="+use+">\u7701"+couponList[i].couponMoneyByYuan+"\u5143:\u5e97\u94fa\u4f18\u60e0\u5238</option>").appendTo(this)}}}$("<option couponid='' value='0' couponMoney='0'>\u65e0\u4f18\u60e0</option>").appendTo(this);this.value=value})}selectboxList.change(function(){changeOption.call(this)});selectboxList.each(function(i){if(i==0){$(this).find("option").eq(0).attr("selected","selected")}else{$(this).val(0)}});selectboxList.each(function(i){if(i==0){changeOption.call(this)}})}function subOrder(){var b=0;var a="";$("input[name*=memberDeliveryId]").each(function(){if($(this).attr("checked")=="checked"){a=$(this).val()}});if(a==""||a=="add"){alert("\u8bf7\u9009\u62e9\u6536\u8d27\u5730\u5740\u6216\u6dfb\u52a0\u4f7f\u7528\u5176\u5b83\u5730\u5740");b=1}$(".isNum").each(function(c){alert("\u8bf7\u5220\u9664\u5e93\u5b58\u4e0d\u8db3\u5546\u54c1\u540e\u518d\u63d0\u4ea4\uff01");b=1});if(b==1){return false}else{if(confirm("\u60a8\u786e\u8ba4\u63d0\u4ea4\u5417\uff1f")){$("input[sendDeliveryId*=sendDeliveryId]").val(a);return true}}return false}function FormatNumber(b,c){var b,c;var a,d;b=""+b+"";strLen=b.length;dotPos=b.indexOf(".",0);if(dotPos==-1){a=b+".";for(i=0;i<c;i++){a=a+"0"}return a}else{if((strLen-dotPos-1)>=c){nAfter=dotPos+c+1;d=1;for(j=0;j<c;j++){d=d*10}a=Math.round(parseFloat(b)*d)/d;return a}else{a=b;for(i=0;i<(c-strLen+dotPos+1);i++){a=a+"0"}return a}}}function getLength(b){if(b==""){return 0}var a=0;for(i=0;i<b.length;i++){var e=b.substr(i,1);var d=escape(e);if(d.substring(0,2)=="%u"){a+=2}else{if(d.substring(0,3)=="%D7"){a+=2}else{a+=1}}}return a};
