$(function(){$.fn.numeral_apply=function(a){a=jQuery.extend({decimalPlace:0,maxLength:30},a||{});$(this).css("ime-mode","disabled");this.bind("keypress",function(c){var b=(c.keyCode?c.keyCode:c.which);if(!$.browser.msie&&(c.keyCode==8)){return}if(b==37||b==39){return}if($(this).val().length>=a.maxLength){return false}if(b==46&&($(this).val().indexOf("."))!=-1){return false}if(a.decimalPlace==0){return(b>=48&&b<=57)||b==46}else{if(b==46&&this.value==""){return false}if(b==46&&this.value.length+1==a.maxLength){return false}return(b>=48&&b<=57)||b==46}});this.bind("blur",function(){if(this.value.length==0){return false}if(this.value==0){this.value=""}var b=$(this).val().indexOf(".");if(isNaN(this.value)){this.value=""}else{if(b==-1&&this.value!=0){this.value=this.value+".00"}else{if(b!=-1&&$(this).val().split(".")[1].length==0){this.value=this.value+"00"}else{if(b!=-1&&$(this).val().split(".")[1].length>=3){this.value=this.value.substring(0,b+3)}else{if(b!=-1&&$(this).val().split(".")[1].length==1){this.value=this.value+"0"}}}}}});this.bind("paste",function(){var b=clipboardData.getData("text");if(isNaN(b)){return false}return false});this.bind("dragenter",function(){return false});this.bind("keyup",function(){if(a.decimalPlace>0){var b=$(this).val().indexOf(".");if(b!=-1&&$(this).val().length-b>a.decimalPlace+1){this.value=this.value.substring(0,b+a.decimalPlace+1)}}})}});$(document).ready(function(){$("#applySum").each(function(){$(this).numeral_apply({decimalPlace:0,maxLength:14})});initLeaveWord();$("#applySum").each(function(){$(this).blur(function(){var value=$(this).val();var xiaoji=$("#xiaoji").val();if(value){value=parseFloat(value);var _val=value+"";if(_val.indexOf(".")!=-1&&_val.split(".")[1].length==1){_val=_val+"0"}$(this).val(_val);var orifinal=$("#originalApplySum").val();if(eval(value)>eval(xiaoji)){var tip="您申请的退款金额"+value+"元已经超过"+xiaoji+"元";popdialog(tip);if(orifinal=="0.00"||orifinal==""){$(this).val(xiaoji)}else{$(this).val(orifinal)}return}var needPaySum=$("#needPayMax").val();var a=(eval(needPaySum)+eval(orifinal)-value).toFixed(2);$("#paysum").html(a)}})});var newApply=new apply();newApply.init();$("#needPaySum").each(function(){$(this).numeral_apply({decimalPlace:0,maxLength:10});$(this).blur(function(){var val=$(this).val();var xiaoji=$("#xiaoji").val();newApply.applyReason=$("#applyReason").val();if(val>0&&newApply.applyReason==9){$(".hong").html(newApply.tipMessage[0]);$(this).val("")}else{if(newApply.applyReason==""&&val>0){popdialog(newApply.tipMessage[3]);$(this).val("");return}else{if(val>0&&newApply.applyReason!=""&&newApply.applyReason!=9){if(xiaoji){var maxVal=(eval(xiaoji)*2+100).toFixed(2);if(eval(val)>eval(maxVal)){popdialog(newApply.tipMessage[1]);$(this).val("")}}}}}})});$(".needSalesReturn").each(function(){$(this).click(function(){var ar=$("#applyReason");ar.find("option").each(function(){$(this).remove()});ar.append("<option value=''>----填写退款原因----</option>");if($(this).attr("value")=="0"){ar.append("<option value='1'>未收到商品</option>");ar.append("<option value='2'>卖家发货不及时</option>");ar.append("<option value='3'>与卖家协商一致退款</option>")}else{if($(this).attr("value")=="1"){ar.append("<option value='7'>收到的货物出现质量问题</option>");ar.append("<option value='8'>收到的货物描述不符</option>");ar.append("<option value='9'>7天无理由退货</option>")}}})});$("#_needSalesReturn").each(function(){var needSalesReturn=$(this).attr("value");if(needSalesReturn==""){return}$(".needSalesReturn").each(function(){if($(this).attr("value")==needSalesReturn){$(this).click();var applyReason=$("#applyReason");var createdApplyReason=$("#createdApplyReason").attr("value");applyReason.find("option").each(function(){if($(this).attr("value")==createdApplyReason){$(this).attr("selected",true)}})}})});$("#hrefApplyRefund").click(function(){if(validateApply()){if(confirm("您仅能针对该商品提交一次退款申请，请您确认退款要求是否合适.")){$("#form").attr({method:"post",action:"/refund/saveApply.htm",enctype:"multipart/form-data"});$("#form").submit();$(this).hide();$("#submitLoad").show()}else{return}}else{return}});$("#updateApplyRefund").click(function(){if(validateApply()){if(confirm("您仅能针对该商品提交一次退款申请，请确认您修改的退款要求是否合适.")){$("#form").submit();$(this).hide();$("#submitLoad").show()}else{return}}else{return}});var value=newApply.applySum,needPaySum=newApply.needPaySum,refundId=$("#createdRefundId").val();if(value!=""&&refundId!=""){$("#paysum").html(needPaySum)}else{if(value!=""){$("#paysum").html((needPaySum-value).toFixed(2))}else{$("#paysum").html("*******")}}});function validateApply(){var newApply=new apply();newApply.applyReason=$("#applyReason").val();newApply.applySum=$("#applySum").val();newApply.needSalesReturn=$(".needSalesReturn").val();newApply.applyMemo=$("#applyMemo").val();if(newApply.applyReason==""){popdialog(newApply.tipMessage[3]);return false}if(newApply.applySum==""){popdialog(newApply.tipMessage[4]);$("#applySum").focus();return false}else{if(newApply.applySum!=""){var value=newApply.applySum;var xiaoji=$("#xiaoji").val();if(eval(value)>eval(xiaoji)){var tip="退款金额不能超过"+xiaoji+"元";popdialog(tip);return false}}}if(newApply.applyMemo==""){popdialog(newApply.tipMessage[5]);return false}return true}function apply(){this.applyReason=$("#applyReason").val();this.applySum=$("#applySum").val();this.needSalesReturn=$(".needSalesReturn").val();this.applyMemo=$("#applyMemo").val();this.xiaoji=$("#xiaoji").val(),this.needPaySum=$("#needPayMax").val(),this.tipMessage=new Array("提示：无理由退货不能申请赔偿，请您自行承担退货产生的运费。","您申请最高限额为双倍赔偿及退货运费，请勿超出赔偿上限标准。","请选择要求赔偿的原因","请选择退款原因","请填写申请退款金额！","请填写退款说明");this.init=function(){var a=$("#applyReason");a.find("option").each(function(){$(this).remove()});a.append("<option value=''>----填写退款原因----</option>");var b=$("input[@name=needSalesReturn]:checked").val();if(b=="0"){a.append("<option value='1'>未收到商品</option>");a.append("<option value='2'>卖家发货不及时</option>");a.append("<option value='3'>与卖家协商一致退款</option>")}else{if(b=="1"){a.append("<option value='7'>收到的货物出现质量问题</option>");a.append("<option value='8'>收到的货物描述不符</option>");a.append("<option value='9'>7天无理由退货</option>")}}}}var popdialog=function(a){art.dialog({time:6,lock:true,background:"#F6F6F6",width:"280px",opacity:0.5,content:a,icon:"warning",ok:true})};